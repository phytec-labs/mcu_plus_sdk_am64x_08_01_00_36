<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: ETHPHY</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">08.01.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('BOARD_ETHPHY_PAGE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ETHPHY </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md613">Features Supported</a></li>
<li class="level1"><a href="#autotoc_md614">SysConfig Features</a></li>
<li class="level1"><a href="#autotoc_md615">Example Usage</a></li>
<li class="level1"><a href="#autotoc_md616">Adding Support for Custom PHY</a></li>
<li class="level1"><a href="#autotoc_md617">API</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_board_ethphy"></a></p>
<p>The ETHPHY driver provides APIs to control the Ethernet PHY devices present on the board. It accesses the PHY registers using the MDIO module.</p>
<h1><a class="anchor" id="autotoc_md613"></a>
Features Supported</h1>
<dl class="section note"><dt>Note</dt><dd>Only the commands needed for Industial Protocol examples are supported</dd></dl>
<ul>
<li>Commands for following things:<ul>
<li>Get the PHY link status</li>
<li>Set/get speed and half-duplex/full-duplex configuration</li>
<li>Configure PHY LEDs</li>
<li>Select MII mode</li>
<li>Soft-restart PHY</li>
<li>Enable Auto MDI-X</li>
<li>Disable 1G Advertisement</li>
<li>Get auto-negotiation status</li>
<li>Get auto-negotiation capability of link partner</li>
<li>Configure features like fast link down detection, extended full duplex ability, odd nibble detection and enhanced IPG detection</li>
<li>Set Tx/Rx FIFO Half Full Threshold for RGMII mode</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md614"></a>
SysConfig Features</h1>
<dl class="section note"><dt>Note</dt><dd>It is strongly recommend to use SysConfig where it is available instead of using direct SW API calls. This will help simplify the SW application and also catch common mistakes early in the development cycle.</dd></dl>
<ul>
<li>Option to select the type of Ethernet PHY<ul>
<li>Supported PHYs<ul>
<li>DP83869</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class="fragment">- CUSTOM
- NONE
</pre><ul>
<li>Option to select the MDIO instance to which PHY is connected</li>
<li>Option to set the PHY address</li>
<li>Based on above parameters, the SysConfig generated code does following:<ul>
<li>Open the ETHPHY instance using <a class="el" href="group__BOARD__ETHPHY__MODULE.html#gad9b0099a1138e12179ea1631bb2fb4bc">ETHPHY_open</a> API as a part of Board_driversOpen. Handle can used by including <code>"ti_board_open_close.h"</code> file.</li>
<li>Close the ETHPHY instance as a part of Board_driversClose</li>
<li>Create macros like <code>CONFIG_ETHPHY0</code> using the name passed in SysConfig. This is used as an index to the array of handles.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md615"></a>
Example Usage</h1>
<p>Include the below file to access the APIs </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ethphy_8h.html">board/ethphy.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;board/ethphy/ethphy_dp83869.h&gt;</span></div>
</div><!-- fragment --><p> Selecting MII mode and soft-resetting the PHY </p><div class="fragment"><div class="line"> </div>
<div class="line">    <span class="comment">/*Use CONFIG_ETHPHY0 macro as an index for the handle array*/</span></div>
<div class="line">    <span class="comment">/* Select MII mode */</span></div>
<div class="line">    status = <a class="code" href="group__BOARD__ETHPHY__MODULE.html#gaf3051e618069fad2c94570cb618812e7">ETHPHY_command</a>(gEthPhyHandle[CONFIG_ETHPHY0], <a class="code" href="group__BOARD__ETHPHY__MODULE.html#ga148127b94a1165c90d0367726fd7609c">ETHPHY_CMD_ENABLE_MII</a>, NULL, 0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Soft-reset PHY */</span></div>
<div class="line">    status = <a class="code" href="group__BOARD__ETHPHY__MODULE.html#gaf3051e618069fad2c94570cb618812e7">ETHPHY_command</a>(gEthPhyHandle[CONFIG_ETHPHY0], <a class="code" href="group__BOARD__ETHPHY__MODULE.html#ga54463d7b7298b502a3ed539a56348a9c">ETHPHY_CMD_SOFT_RESTART</a>, NULL, 0);</div>
</div><!-- fragment --><p> Configuring PHY LED sources </p><div class="fragment"><div class="line">    ETHPHY_DP83869_LedSourceConfig  ledConfig;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*Use CONFIG_ETHPHY0 macro as an index for the handle array*/</span></div>
<div class="line">    <span class="comment">/* Configure source of PHY LEDs */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* PHY pin LED_0 as link for fast link detection */</span></div>
<div class="line">    ledConfig.ledNum = ETHPHY_DP83869_LED0;</div>
<div class="line">    ledConfig.mode = ETHPHY_DP83869_LED_MODE_LINK_OK;</div>
<div class="line">    status = <a class="code" href="group__BOARD__ETHPHY__MODULE.html#gaf3051e618069fad2c94570cb618812e7">ETHPHY_command</a>(gEthPhyHandle[CONFIG_ETHPHY0], <a class="code" href="group__BOARD__ETHPHY__MODULE.html#ga680898e9adea5e08921d14e2165ec523">ETHPHY_CMD_CONFIGURE_LED_SOURCE</a>, (<span class="keywordtype">void</span> *)&amp;ledConfig, <span class="keyword">sizeof</span>(ledConfig));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* PHY pin LED_1 as 1G link established */</span></div>
<div class="line">    ledConfig.ledNum = ETHPHY_DP83869_LED1;</div>
<div class="line">    ledConfig.mode = ETHPHY_DP83869_LED_MODE_1000BT_LINK_UP;</div>
<div class="line">    status = <a class="code" href="group__BOARD__ETHPHY__MODULE.html#gaf3051e618069fad2c94570cb618812e7">ETHPHY_command</a>(gEthPhyHandle[CONFIG_ETHPHY0], <a class="code" href="group__BOARD__ETHPHY__MODULE.html#ga680898e9adea5e08921d14e2165ec523">ETHPHY_CMD_CONFIGURE_LED_SOURCE</a>, (<span class="keywordtype">void</span> *)&amp;ledConfig, <span class="keyword">sizeof</span>(ledConfig));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* PHY pin LED_2 as Rx/Tx Activity */</span></div>
<div class="line">    ledConfig.ledNum = ETHPHY_DP83869_LED2;</div>
<div class="line">    ledConfig.mode = ETHPHY_DP83869_LED_MODE_LINK_OK_AND_BLINK_ON_RX_TX;</div>
<div class="line">    status = <a class="code" href="group__BOARD__ETHPHY__MODULE.html#gaf3051e618069fad2c94570cb618812e7">ETHPHY_command</a>(gEthPhyHandle[CONFIG_ETHPHY0], <a class="code" href="group__BOARD__ETHPHY__MODULE.html#ga680898e9adea5e08921d14e2165ec523">ETHPHY_CMD_CONFIGURE_LED_SOURCE</a>, (<span class="keywordtype">void</span> *)&amp;ledConfig, <span class="keyword">sizeof</span>(ledConfig));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* PHY pin LED_3 as 100M link established */</span></div>
<div class="line">    ledConfig.ledNum = ETHPHY_DP83869_LED_GPIO;</div>
<div class="line">    ledConfig.mode = ETHPHY_DP83869_LED_MODE_10_OR_100BT_LINK_UP;</div>
<div class="line">    status = <a class="code" href="group__BOARD__ETHPHY__MODULE.html#gaf3051e618069fad2c94570cb618812e7">ETHPHY_command</a>(gEthPhyHandle[CONFIG_ETHPHY0], <a class="code" href="group__BOARD__ETHPHY__MODULE.html#ga680898e9adea5e08921d14e2165ec523">ETHPHY_CMD_CONFIGURE_LED_SOURCE</a>, (<span class="keywordtype">void</span> *)&amp;ledConfig, <span class="keyword">sizeof</span>(ledConfig));</div>
<div class="line"> </div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md616"></a>
Adding Support for Custom PHY</h1>
<p>In the SysConfig for ETHPHY, there are following options apart from the Ethernet PHYs supported in the SDK :</p>
<ol type="1">
<li>CUSTOM : Generate SysConfig code with a custom PHY name. <code>extern <a class="el" href="structETHPHY__Fxns.html" title="ETHPHY Driver implementation callbacks.">ETHPHY_Fxns</a> gEthPhyFxns_MyEthPhyDevice;</code> will be added in the <code>ti_board_open_close.c</code> file generated by SysConfig. Hence <a class="el" href="structETHPHY__Fxns.html">ETHPHY_Fxns</a> should be defined for the custom PHY. Essentially one needs to write code similar to a supported PHY device (For an example, see <code>${SDK_INSTALL_PATH}/source/board/ethphy/ethphy_dp83869.c</code>). <a class="el" href="group__BOARD__ETHPHY__MODULE.html">APIs for Ethernet PHY</a> can be used directly in this case.</li>
<li>NONE : SysConfig does not generate any code for ETHPHY. Modules like EtherCAT and Ethernet (ICSS) add instances of ETHPHY in SysConfig. This option can be used if the PHY implementation is custom, and you do not want any code to be generated from SysConfig. <a class="el" href="group__BOARD__ETHPHY__MODULE.html">APIs for Ethernet PHY</a> can not be used directly in this case.</li>
</ol>
<h1><a class="anchor" id="autotoc_md617"></a>
API</h1>
<p><a class="el" href="group__BOARD__ETHPHY__MODULE.html">APIs for Ethernet PHY</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="agroup__BOARD__ETHPHY__MODULE_html_ga680898e9adea5e08921d14e2165ec523"><div class="ttname"><a href="group__BOARD__ETHPHY__MODULE.html#ga680898e9adea5e08921d14e2165ec523">ETHPHY_CMD_CONFIGURE_LED_SOURCE</a></div><div class="ttdeci">#define ETHPHY_CMD_CONFIGURE_LED_SOURCE</div><div class="ttdoc">Command to configure the source of PHY LEDs. &quot;data&quot; argument should be passed while making ETHPHY_com...</div><div class="ttdef"><b>Definition:</b> ethphy.h:95</div></div>
<div class="ttc" id="agroup__BOARD__ETHPHY__MODULE_html_ga54463d7b7298b502a3ed539a56348a9c"><div class="ttname"><a href="group__BOARD__ETHPHY__MODULE.html#ga54463d7b7298b502a3ed539a56348a9c">ETHPHY_CMD_SOFT_RESTART</a></div><div class="ttdeci">#define ETHPHY_CMD_SOFT_RESTART</div><div class="ttdoc">Command for Soft Restart. It restarts the PHY without affecting registers.</div><div class="ttdef"><b>Definition:</b> ethphy.h:75</div></div>
<div class="ttc" id="agroup__BOARD__ETHPHY__MODULE_html_ga148127b94a1165c90d0367726fd7609c"><div class="ttname"><a href="group__BOARD__ETHPHY__MODULE.html#ga148127b94a1165c90d0367726fd7609c">ETHPHY_CMD_ENABLE_MII</a></div><div class="ttdeci">#define ETHPHY_CMD_ENABLE_MII</div><div class="ttdoc">Command to configure the PHY in MII mode.</div><div class="ttdef"><b>Definition:</b> ethphy.h:71</div></div>
<div class="ttc" id="aethphy_8h_html"><div class="ttname"><a href="ethphy_8h.html">ethphy.h</a></div></div>
<div class="ttc" id="agroup__BOARD__ETHPHY__MODULE_html_gaf3051e618069fad2c94570cb618812e7"><div class="ttname"><a href="group__BOARD__ETHPHY__MODULE.html#gaf3051e618069fad2c94570cb618812e7">ETHPHY_command</a></div><div class="ttdeci">int32_t ETHPHY_command(ETHPHY_Handle handle, uint32_t command, void *data, uint32_t dataSize)</div><div class="ttdoc">Send a command to the ETHPHY.</div></div>
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
