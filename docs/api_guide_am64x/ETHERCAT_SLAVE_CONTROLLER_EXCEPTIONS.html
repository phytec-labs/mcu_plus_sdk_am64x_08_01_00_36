<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: TI EtherCAT Slave Controller Exceptions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">08.01.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ETHERCAT_SLAVE_CONTROLLER_EXCEPTIONS.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">TI EtherCAT Slave Controller Exceptions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_components_industrial_comms_ethercat_slave_exceptions"></a> This page lists the exceptions TI's EtherCAT Slave Controller implementation when compared with ET1100 ASIC.</p>
<h1><a class="anchor" id="autotoc_md659"></a>
Register Exceptions</h1>
<p>TI ESC register map is fully compatible with ET1100 ASIC register map except for the registers and register fields documented below.</p>
<table class="doxtable">
<tr>
<th><b>Register(s)</b> </th><th><b>Remarks</b>  </th></tr>
<tr>
<td>Write Register Enable (0x0020)<br  />
 Write Register Protection (0x0021)<br  />
 ESC Write Enable (0x0030)<br  />
 ESC Write Protection (0x0031) </td><td><b>Not available in TI ESC</b>  </td></tr>
<tr>
<td>PDI Control (0x0140)<br  />
 ESC Configuration (0x0141) </td><td>PDI side access is an exception. RW access is enabled to allow loading of 0x140 and 0x141 from EEPROM ADDR: 0x0000 during RESET. TI ESC uses EEPROM emulation mode. For more details, see <a class="el" href="ETHERCAT_SLAVE_CONTROLLER_EXCEPTIONS.html#ETHERCAT_SLAVE_EXCEPTIONS_ESI_EEPROM_EMULATION_SUPPORT">ESI EEPROM Emulation Support</a>.  </td></tr>
<tr>
<td>PDI configuration (0x0150)<br  />
 Sync/Latch[1:0] PDI Configuration (0x0151) </td><td>NOT loaded from EEPROM ADDR: 0x0001 during RESET. This is read only and only bit field 3 and 7 are valid i.e. SYNC0/1 mapped to AL Event Request register 0x0220.2/0x0220.3. Beckhoff is going to make proposal to ETG to make EEPROM loading of this register [0x0150:0x0153] on RESET as well as PDI side implementation ESC vendor specific.  </td></tr>
<tr>
<td>On-chip bus extended configuration (0x0152:0x0153) </td><td><b>Not available in TI ESC</b>  </td></tr>
<tr>
<td>RX Invalid Frame Counter Port 0 &amp; 1 (0x0300 and 0x302) </td><td>Too short frames (&lt; 64 Byte) are counted by TI ESC for Port1 if both ports are connected.  </td></tr>
<tr>
<td>RX Error Counter of Port 0 &amp; 1 (0x0301 and 0x303) </td><td>TI ESC does not count RX_ER in MII_CLK units (counts number of frames encountered RX_ER). RX_ERs outside frame is not counted. (This will be fixed)  </td></tr>
<tr>
<td>ECAT Processing Unit Error Counter(0x030C) </td><td>Physical layer errors are not counted by TI ESC.  </td></tr>
<tr>
<td>0x0300, 0x0301, 0x0302, 0x0303, 0x0304, 0x0308, 0x0309, 0x30C </td><td>For long frames errors, TI ESC considers frames of length &gt; 1522B  </td></tr>
<tr>
<td>PDI Error Counter (0x030D) </td><td><b>Not available in TI ESC</b>  </td></tr>
<tr>
<td>Watchdog Divider (0x0400:0x0401) </td><td>For TI ESC max value is 327.64 us or 8189 (13-bit wide and NOT 16-bit) because of 200MHz clock tick. If one programs &gt; 13 bits, upper 3-bits are lost as firmware shifts 3-bits (25MHz clock to 200MHz clock conversion by multiplying with 8) before programming to HW register.  </td></tr>
<tr>
<td>Status SyncManager 0 : 0x0805.Bits4-7 <br  />
 Status SyncManager 1 : 0x080D.Bits4-7 <br  />
 Status SyncManager 2 : 0x0815.Bits4-7 <br  />
 Status SyncManager 3 : 0x081D.Bits4-7 <br  />
 Status SyncManager 4 : 0x0825.Bits4-7 <br  />
 Status SyncManager 5 : 0x082D.Bits4-7 <br  />
 Status SyncManager 6 : 0x0835.Bits4-7 <br  />
 Status SyncManager 7 : 0x083D.Bits4-7 </td><td>Following Bits are NOT implemented Bit 4-5: Buffered mode: buffer status (last written buffer)<br  />
 00: 1. buffer<br  />
 01: 2. buffer<br  />
 10: 3. buffer<br  />
 11: (no buffer written)<br  />
 Mailbox mode: reserved<br  />
 Bit 6: Read buffer in use (opened)<br  />
 Bit 7: Write buffer in use (opened)<br  />
  </td></tr>
<tr>
<td>Activate SyncManager 0 : 0x806.Bits6-7 <br  />
 Activate SyncManager 1 : 0x80E.Bits6-7 <br  />
 Activate SyncManager 2 : 0x816.Bits6-7 <br  />
 Activate SyncManager 3 : 0x81E.Bits6-7 <br  />
 Activate SyncManager 4 : 0x826.Bits6-7 <br  />
 Activate SyncManager 5 : 0x82E.Bits6-7 <br  />
 Activate SyncManager 6 : 0x836.Bits6-7 <br  />
 Activate SyncManager 7 : 0x83E.Bits6-7 </td><td>Following Bits are NOT implemented <br  />
 Bit 6: Latch Event ECAT <br  />
 1: Generate Latch event if EtherCAT master issues a buffer exchange <br  />
 Bit 7: Latch Event PDI <br  />
 1: Generate Latch events if PDI issues a buffer exchange or if PDI accesses buffer start address  </td></tr>
<tr>
<td>Start Time Cyclic Operation (0x0990:0x0997) </td><td>System time of next pulse register (0x990:0x993) is not updated instantaneously, resulting in read of incorrect value if read immediately after sync pulse.  </td></tr>
<tr>
<td>Latch0 Status (0x09AE).Bit2<br  />
 Latch1 Status (0x09AF).Bit2 </td><td>Following Bit is not implemented<br  />
 Bit 2: Latch0/1 pin state  </td></tr>
<tr>
<td>EtherCAT Buffer Change Event Time (0x09F0:0x09F3) <br  />
 PDI Buffer Start Event Time (0x09F8:0x09FB) <br  />
 PDI Buffer Change Event Time (0x09FC:0x09FF) </td><td><b>Not available in TI ESC</b>  </td></tr>
<tr>
<td>Digital Outputs (0x0F00:0x0F03) </td><td>Digital Outputs are updated at the end of an EtherCAT frame which triggered the Process Data Watchdog in ET1100 with typical SyncManager configuration: a frame containing a write access to at least one of the registers 0x0F00:0x0F03. TI ESC firmware requires SyncManager address to be higher than or equal to 0x1000.  </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md660"></a>
Known Issues with no plans to fix</h1>
<table class="doxtable">
<tr>
<th><b>Issue</b> </th><th><b>Description</b>  </th></tr>
<tr>
<td>PINDSW-47/SDOCM00092510: Single datagram accessing multiple FMMU mapped areas using LRD/LWR commands from a single slave </td><td>Increased codememory requirements needed in firmware to implement this support. LRW command supports this which is more optimal with lower framing overhead. Minor use case impact as more optimal solutions exists. May cause interop issues with certain masters if 8 SM is supported by slave and all of them are accessed via single logical datagram  </td></tr>
<tr>
<td>PINDSW-72/SDOCM00098105: PDI/PD watchdog counter incremented by 1 whenever PDI/PD watchdog is disabled using EtherCAT master </td><td>Whenever EtherCAT master disables WD by writing zero to respective Watchdog Time registers (0x0410:0x0411 or 0x0420:0x0421). ICSS h/w limitation, can potentially workaround in firmware by maintaining this counter in firmware but require additional instructions. This has very minor use case impact to undertake this.  </td></tr>
<tr>
<td>PINDSW-74/SDOCM00098950: LRD access on unused registers results in WKC increment </td><td>Firmware does not support register protection in LRD mode at this moment, it requires more firmware footprint to support, this minor spec compliance does not justify the footprint increase and there are no Write Only registers in ESC. LRD access to unused register is not a practical use case.  </td></tr>
<tr>
<td>PINDSW-141/SDOCM00105048: LRW access to non-interleaved input and output process data of multiple slaves does not work </td><td><p class="starttd"><b>Conditions in which failures occur</b><br  />
 Single LRW datagram accessing FMMU mapped areas in multiple slaves and PD out is mapped.<br  />
 FMMU0(0x1000:0x1007)-&gt; SM2#1(Write SM)<br  />
 FMMU1(0x1008:0x100F)-&gt;SM 2#2(Write SM)<br  />
 FMMU2(0x1010:0x1017)-&gt;SM 3#1(Read SM)<br  />
 FMMU3(0x1018:0x101F)-&gt;SM 3#2(Read SM)<br  />
 Single LRW access from (0x1000:101F)<br  />
</p>
<p class="intertd"><b>Root Cause</b><br  />
 Pointer management is optimized for interleaved access as well as non-interleaved access I/O data is not a very optimal use of EtherCAT. It increases the cycle time overhead/datagram size and not effective use of LRW datagram which can perform read and write in the same cycle.<br  />
</p>
<p class="endtd"><b>Work-around</b><br  />
 Use LRD/LWR datagram to access process data Use LRW datagram to access process data Input and output overlaid on the same logical address range (TwinCAT usage)<br  />
 Input and output of a given slave back to back in logical address space<br  />
 FMMU0(0x1000:0x1007)-&gt;SM 2 #1(Write SM)<br  />
 FMMU1(0x1008:0x100F)-&gt;SM 3#1 (Read SM)<br  />
 FMMU2 (0x1010:0x1017)-&gt;SM2 #2 (Write SM)<br  />
 FMMU3(0x1018:0x101F)-&gt;SM 3#2(Read SM)<br  />
  </p>
</td></tr>
</table>
<h1><a class="anchor" id="autotoc_md661"></a>
Known Functional Differences</h1>
<table class="doxtable">
<tr>
<th><b>Functional Difference</b> </th><th><b>Description</b>  </th></tr>
<tr>
<td>Increased Process Path latency </td><td>There are certain scenarios under which TI ESC requires increased process path latency. Please refer to section 3.6.2 of <a href="https://www.ti.com/lit/an/spracj7/spracj7.pdf">PRU-ICSS EtherCAT Slave Troubleshooting Guide</a> for more details.  </td></tr>
<tr>
<td>Enhanced link detection using RX_ERR and PHY does not support fast link detection </td><td>RX_ERR detection is valid only during inside frame. This may not be as reliable as ET1100 which supports RX_ERR detection outside frame.  </td></tr>
<tr>
<td>APRW/FPRW/BRW for SM mapped process data memory </td><td>This is not a valid use as RW access to SM mapped area does not make sense.  </td></tr>
<tr>
<td>LINKACT LED is controlled using the Link/Activity signals from the PHY </td><td>It is recommended to drive the LINKACT LED from ESC, instead of the Link/Activity LED signals of the PHY. <br  />
 <b>Possible Solution</b> <br  />
 PHY LEDs can be controlled from R5F by periodically monitoring change in following registers:<br  />
 RX Port0 frame counter(0x0E00:0x0E03)<br  />
 RX Port1 frame counter(0x0E04:0x0E07)<br  />
  </td></tr>
</table>
<h1><a class="anchor" id="ETHERCAT_SLAVE_EXCEPTIONS_ESI_EEPROM_EMULATION_SUPPORT"></a>
ESI EEPROM Emulation Support</h1>
<p>TI ESC follows section "11.2.4 EEPROM Emulation" in <a href="https://download.beckhoff.com/download/Document/io/ethercat-development-products/ethercat_esc_datasheet_sec1_technology_2i3.pdf">EtherCAT ESC Datasheet Section 1 - Technology</a> from functional principle point of view. This is typically used in IP core based ESCs with non-volatile memory. Here, host CPU emulates all EEPROM operations (read/write/reload) using RAM and from EtherCAT master point of view, this is equivalent to I2C EEPROM managed by ESC.</p>
<p>In ET1100 ASIC, the EtherCAT master can invoke reloading the EEPROM content. In this case the Configured Station Alias 0x0012:0x0013 and PDI Control Bit 0x0140.9 (enhanced link detection) are not taken over, they are only taken over at the initial EEPROM loading after power-on or reset.</p>
<p>In IP core based ESCs, however the read data for a reload command (or the initial EEPROM loading) is reduced to the Configured Station Alias (0x0012:0x0013) and the Enhanced Link Detection Enables (0x0140[9], 0x0140[15:12]). IP core uses scheme described in section "2.45.1 EEPROM emulation with 32 bit EEPROM data register" of <a href="https://download.beckhoff.com/download/Document/io/ethercat-development-products/ethercat_esc_datasheet_sec2_registers_3i0.pdf">EtherCAT ESC Datasheet Section 2 - Register Description</a>. There are some exceptions to how this implemented in TI ESC, compared to IP core.</p>
<ul>
<li>Configured Station Alias, Enhanced Link Detection Enables and DL status Bit2 is updated directly by FWHAL during initial EEPROM loading operation. This is similar to ET1100 ASIC, and exception to IP core based ESCs.</li>
<li>PDI configuration (0x150:0x153) are not loaded during EEPROM reload/inital load. However this is programmable if customers want to make it similar to ET1100 ASIC. We kept this way because PDI configuration programmability is limited for TI ESC. This is similar to IP core based ESCs.</li>
<li>Register Pulse Length of SyncSignals (0x0982:0x983) is updated from EEPROM ADR 0x0002 during reload operation. This is similar to ET1100 ASIC, and exception to IP core based ESCs. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
