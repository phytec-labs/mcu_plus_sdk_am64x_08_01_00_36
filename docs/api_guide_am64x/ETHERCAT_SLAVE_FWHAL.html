<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: EtherCAT Slave FWHAL</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">08.01.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ETHERCAT_SLAVE_FWHAL.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">EtherCAT Slave FWHAL </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md646">Introduction</a></li>
<li class="level1"><a href="#autotoc_md647">SysConfig Features</a></li>
<li class="level1"><a href="#autotoc_md648">PRU-ICSS EtherCAT Slave Firmware</a><ul><li class="level2"><a href="#autotoc_md649">Features Supported</a></li>
<li class="level2"><a href="#autotoc_md650">Features Not Supported</a></li>
<li class="level2"><a href="#autotoc_md651">Known Issues</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md652">Important Files and Directory Structure</a></li>
<li class="level1"><a href="#autotoc_md653">API Documentation</a></li>
<li class="level1"><a href="#autotoc_md654">Procedure to kick-off the EtherCAT Slave Controller(ESC)</a></li>
<li class="level1"><a href="#autotoc_md655">Interrupts</a></li>
<li class="level1"><a href="#autotoc_md656">EtherCAT Slave Controller(ESC) Register List</a></li>
<li class="level1"><a href="#autotoc_md657">EtherCAT Slave Controller(ESC) Exceptions</a></li>
<li class="level1"><a href="#ETHERCAT_SLAVE_ADDITIONAL_REFERENCES">Additional References</a></li>
<li class="level1"><a href="#autotoc_md658">See also</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_industrial_comms_ethercat_slave"></a></p>
<h1><a class="anchor" id="autotoc_md646"></a>
Introduction</h1>
<p>This software is designed for the TI SoCs with PRU-ICSS IP to enable customers add EtherCAT Slave protocol support to their system. It implements EtherCAT Slave Controller(ESC) Layer 2 functionality with two MII ports (one IN and one OUT port per PRU-ICSS) in accordance with ETG.1000.4 Data Link Layer protocol specification. This provides EtherCAT ASIC like functionality integrated into TI SoCs.</p>
<div class="image">
<img src="EtherCAT_Slave_Software_Architecture.png" alt=""/>
<div class="caption">
Software Architecture</div></div>
<p>EtherCAT firmware for PRU-ICSS is a black box product maintained by TI. EtherCAT Slave FWHAL(Firmware and Hardware Abstraction Layer) allows loading and running the EtherCAT firmware and acts as an interface with ESC firmware. FWHAL implements the key interface between EtherCAT Slave Controller Emulation firmware and EtherCAT stack.</p>
<h1><a class="anchor" id="autotoc_md647"></a>
SysConfig Features</h1>
<dl class="section note"><dt>Note</dt><dd>It is strongly recommend to use SysConfig where it is available instead of using direct SW API calls. This will help simplify the SW application and also catch common mistakes early in the development cycle.</dd></dl>
<p>SysConfig can be used to configure things mentioned below:</p><ul>
<li>Selecting the PRU-ICSS instance</li>
<li>Configuring PINMUX needed for MII mode</li>
<li>Configuring ETHPHY for the two PHY ports of PRU-ICSS</li>
</ul>
<h1><a class="anchor" id="autotoc_md648"></a>
PRU-ICSS EtherCAT Slave Firmware</h1>
<h2><a class="anchor" id="autotoc_md649"></a>
Features Supported</h2>
<ul>
<li>All EtherCAT Commands (NOP, APRD, APWR, APRW, FPRD, FPWR, FPRW, BRD, BWR, BRW, LRD, LWR, LRW, ARMW and FRMW)</li>
<li>8 FMMU support</li>
<li>8 SM support</li>
<li>59KB of Process Data RAM</li>
<li>Distributed clocks<ul>
<li>64-bit DC</li>
<li>SYNC0 out generation single shot and cyclic mode support</li>
<li>SYNC1 out generation - SYNC1 cycle time multiple of SYNC0 cycle time</li>
<li>Latch0 and Latch1 inputs</li>
<li>System Time PDI control</li>
</ul>
</li>
<li>DL Loop Control<ul>
<li>Using MII_RX_LINK (fast - depending on PHY link loss detection latency) - mandatory for cable redundancy support</li>
<li>Using PRU-ICSS MDIO state machine - not recommended for cable redundancy support</li>
</ul>
</li>
<li>Interrupts - AL/ECAT events<ul>
<li>SYNC0, SYNC1 and PDI interrupt events on external SOC pins</li>
</ul>
</li>
<li>Watchdog - PDI and SM</li>
<li>Error Counters<ul>
<li>RX Invalid Frame Counter Port 0/1</li>
<li>RX ERR Counter Port 0/1</li>
<li>Forwarded Error Counter Port 0/1</li>
<li>ECAT Processing Unit Error Counter</li>
</ul>
</li>
<li>LED - Run, Error and Port0/1 activity</li>
<li>EEPROM Emulation for ESI EEPROM support</li>
<li>Management Interface for PHY over EtherCAT</li>
<li>PHY address configuration and host side API for PHY programming</li>
<li>Cable redundancy support</li>
</ul>
<h2><a class="anchor" id="autotoc_md650"></a>
Features Not Supported</h2>
<ul>
<li>EtherCAT Slave Controller<ul>
<li>ECAT side register protection when using LRD command</li>
<li>APRW/FPRW/BRW for SM mapped area</li>
</ul>
</li>
<li>EtherCAT G</li>
<li>Reset Isolation</li>
</ul>
<h2><a class="anchor" id="autotoc_md651"></a>
Known Issues</h2>
<table class="doxtable">
<tr>
<th>Record ID </th><th>Details </th><th>Workaround  </th></tr>
<tr>
<td>PINDSW-47 </td><td>Multiple FMMU access in a single datagram to a slave for process data using LRD/LWR commands </td><td>Use LRW instead of LRD/LWR  </td></tr>
<tr>
<td>PINDSW-72 </td><td>PDI/PD watchdog counter incremented by 1 whenever PDI/PD watchdog is disabled </td><td>None  </td></tr>
<tr>
<td>PINDSW-74 </td><td>LRD access on unused registers increment WKC - no register protection while using LRD </td><td>None  </td></tr>
<tr>
<td>PINDSW-141 </td><td>LRW access to non-interleaved input and output process data of multiple slaves does not work. SOEM accesses slaves in LRW mode this way </td><td>Use LRD/LWR for process data access or use more optimal interleaved access for process data access from Master (TwinCAT way)  </td></tr>
<tr>
<td>PINDSW-2204 </td><td>Frames with no SFD not counted as errors if received on reverse path </td><td>None  </td></tr>
<tr>
<td>PINDSW-2360 </td><td>System time of next Sync0 pulse register (0x990:0x993) is not instantaneous, resulting in read of incorrect value if read immediately after sync pulse </td><td>None  </td></tr>
<tr>
<td>PINDSW-5135 </td><td>Read permissions and byte level write permissions for RW type commands are not checked </td><td>None  </td></tr>
</table>
<p>For more details, please see the <a href="../industrial_protocol_docs/EtherCAT_Slave_Errata.pdf">EtherCAT Slave Errata</a> document.</p>
<h1><a class="anchor" id="autotoc_md652"></a>
Important Files and Directory Structure</h1>
<table class="doxtable">
<tr>
<th>Folder/Files </th><th>Description  </th></tr>
<tr>
<td colspan="2" bgcolor="#F0F0F0">${SDK_INSTALL_PATH}/examples/industrial_comms </td></tr>
<tr>
<td>ethercat_slave_demo/simple </td><td>EtherCAT Slave Simple Example (based on pre-integrated stack)   </td></tr>
<tr>
<td>ethercat_slave_demo/cia402 </td><td>EtherCAT Slave CiA402 Example (based on pre-integrated stack)   </td></tr>
<tr>
<td>ethercat_slave_demo/ctt </td><td>EtherCAT Slave CTT Example (based on pre-integrated stack)   </td></tr>
<tr>
<td>ethercat_slave_beckhoff_ssc_demo </td><td>EtherCAT Slave Example based on Beckhoff SSC  </td></tr>
<tr>
<td colspan="2" bgcolor="#F0F0F0">${SDK_INSTALL_PATH}/source/industrial_comms/ethercat_slave </td></tr>
<tr>
<td>icss_fwhal/firmware </td><td>Firmware for the PRU cores in PRU-ICSS. <b>Firmware Version : 5.4.243</b>   </td></tr>
<tr>
<td>icss_fwhal/lib/ </td><td>FWHAL library for EtherCAT Slave  </td></tr>
<tr>
<td><a class="el" href="tiescbsp_8h.html">icss_fwhal/tiescbsp.h</a> </td><td>FWHAL interface file  </td></tr>
<tr>
<td>stack/*.lib </td><td>Evaluation libraries for EtherCAT Slave Stack  </td></tr>
<tr>
<td>stack/esi </td><td>ESI XML files for EtherCAT Slave Simple Example and EtherCAT Slave CiA402 Example  </td></tr>
<tr>
<td>stack/inc </td><td>Stack header files for evaluation stack  </td></tr>
<tr>
<td>beckhoff_stack/esi </td><td>ESI XML file for Beckhoff Slave Stack Code(SSC) based example  </td></tr>
<tr>
<td>beckhoff_stack/patch </td><td>Patch file for Beckhoff Slave Stack Code(SSC) sources  </td></tr>
<tr>
<td>beckhoff_stack/stack_hal </td><td>Stack adaptation APIs for Beckhoff Slave Stack Code(SSC)  </td></tr>
<tr>
<td>beckhoff_stack/stack_sources </td><td>Folder where Beckhoff Slave Stack Code(SSC) sources should be copied. Stack sources are not packaged in the SDK  </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md653"></a>
API Documentation</h1>
<p>Please see <a class="el" href="group__INDUSTRIAL__COMMS__ETHERCAT__SLAVE__FWHAL__MODULE.html">APIs for Ethercat Slave FWHAL</a> for API documentation.</p>
<p>It is recommended to use these FWHAL APIs in the stack adaptation files. For example, see <code>${SDK_INSTALL_PATH}/source/industrial_comms/ethercat_slave/beckhoff_stack/stack_hal</code>, which contains the stack adaptation APIs for Beckhoff Slave Stack Code(SSC).</p>
<h1><a class="anchor" id="autotoc_md654"></a>
Procedure to kick-off the EtherCAT Slave Controller(ESC)</h1>
<ul>
<li>Initialize memories (register protection, register reset values, EEPROM cache) and PRU-ICSS INTC module. This is done by FWHAL(Firmware and Hardware Abstraction Layer).</li>
<li>Load firmware into PRUs of PRU-ICSS. This is done by FWHAL.</li>
<li>Enable the PRU cores. This is done by FWHAL.</li>
<li>Initialize the EtherCAT slave stack.</li>
<li>Wait for AL Event Request and SYNC (in DC synchronous mode) interrupts from PRU and run EtherCAT stack main loop for handling mailbox and ESC state machine.</li>
<li>Handle the events as needed. Note that this is handled by the stack.</li>
</ul>
<h1><a class="anchor" id="autotoc_md655"></a>
Interrupts</h1>
<p>EtherCAT Slave Controller firmware generates the following interrupts.</p>
<p>8 Host Interrupts (Host Interrupts 2 through 9) are exported from the PRU_ICSSG internal INTC for signaling the device level interrupt controllers. PRU_EVTOUT0 to PRU_EVTOUT7 correspond to these eight interrupts in the following table. Please check <a class="el" href="DRIVERS_PRUICSS_PAGE.html#PRUICSS_INTC">PRUICSS Interrupt Controller</a> section for more details.</p>
<table class="doxtable">
<tr>
<th>Name </th><th>Host Interrupt </th><th>Description  </th></tr>
<tr>
<td>DC SYNC0 OUT </td><td>PRU_EVTOUT1 </td><td>Used in DC mode for syncing the application  </td></tr>
<tr>
<td>DC SYNC1 OUT </td><td>PRU_EVTOUT2 </td><td>Used in DC mode for syncing the application  </td></tr>
<tr>
<td>PDI Interrupt </td><td>PRU_EVTOUT3 </td><td>AL event/PDI interrupt to host stack  </td></tr>
<tr>
<td>ESC Command Acknowledgement </td><td>PRU_EVTOUT4 </td><td>ESC firmware command completion acknowledgement to Host  </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md656"></a>
EtherCAT Slave Controller(ESC) Register List</h1>
<p><a class="el" href="ETHERCAT_SLAVE_CONTROLLER_REGISTER_LIST.html">TI EtherCAT Slave Controller Register List</a> contains descriptions of the registers in TI's EtherCAT Slave Controller implementation.</p>
<h1><a class="anchor" id="autotoc_md657"></a>
EtherCAT Slave Controller(ESC) Exceptions</h1>
<p><a class="el" href="ETHERCAT_SLAVE_CONTROLLER_EXCEPTIONS.html">TI EtherCAT Slave Controller Exceptions</a> lists the exceptions TI's EtherCAT Slave Controller implementation when compared with ET1100 ASIC. Please note that TI ESC is a 2 port EtherCAT slave and it does not support E-bus interface and all the corresponding register fields are not implemented.</p>
<h1><a class="anchor" id="ETHERCAT_SLAVE_ADDITIONAL_REFERENCES"></a>
Additional References</h1>
<p>Please refer to below documents to understand more about EtherCAT slave on TI platforms and EtherCAT slave protocol specifications.</p>
<table class="doxtable">
<tr>
<th>Document </th><th>Description  </th></tr>
<tr>
<td><a href="https://www.ti.com/lit/pdf/spry187">EtherCAT on Sitara Processors</a> </td><td>Application note by TI on the EtherCAT slave implementation on TI's Sitara Processors.  </td></tr>
<tr>
<td><a href="https://www.ti.com/lit/an/spracj7/spracj7.pdf">PRU-ICSS EtherCAT Slave Troubleshooting Guide</a> </td><td>This troubleshooting guide is intended to provide guidance on how to set up and debug the EtherCAT slave implemented on TI's Sitara processors.  </td></tr>
<tr>
<td><a href="https://download.beckhoff.com/download/Document/io/ethercat-development-products/ethercat_esc_datasheet_sec1_technology_2i3.pdf">EtherCAT ESC Datasheet Section 1 - Technology</a> </td><td>Section 1 of Beckhoff's EtherCAT Slave Controller (ESC) documentation which describes basic EtherCAT technology.  </td></tr>
<tr>
<td><a href="https://download.beckhoff.com/download/Document/io/ethercat-development-products/ethercat_esc_datasheet_sec2_registers_3i0.pdf">EtherCAT ESC Datasheet Section 2 - Register Description</a> </td><td>Section 2 of Beckhoff's EtherCAT Slave Controller (ESC) documentation which contains ESC register descriptions.  </td></tr>
<tr>
<td><a href="https://download.beckhoff.com/download/document/io/ethercat-development-products/an_et9300_v1i8.pdf">Application Note ET9300 (EtherCAT Slave Stack Code)</a> </td><td>This contains details on how to start EtherCAT Slave development with Slave Stack Code.  </td></tr>
<tr>
<td><a href="https://www.ethercat.org/download/documents/ETG2200_V3i1i0_G_R_SlaveImplementationGuide.pdf">EtherCAT Slave Implementation Guide from EtherCAT Technology Group</a> </td><td>This contains information on how to develop an EtherCAT slave implementation.  </td></tr>
<tr>
<td><a href="https://download.beckhoff.com/download/document/io/ethercat-development-products/ethercat_slave_design_quick_guide.pdf">EtherCAT Slave Design Quick Guide from Beckhoff</a> </td><td>This contains information on modifying PDO when using Beckhoff SSC Tool for code generation.  </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md658"></a>
See also</h1>
<ul>
<li><a class="el" href="EXAMPLES_INDUSTRIAL_COMMS_ETHERCAT_SLAVE_DEMOS.html">EtherCAT Slave Demos</a></li>
<li><a class="el" href="EXAMPLES_INDUSTRIAL_COMMS_ETHERCAT_SLAVE_BECKHOFF_SSC_DEMO.html">EtherCAT Slave Beckhoff SSC Example</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
