<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: EtherNet/IP Adapter FWHAL</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">08.01.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ETHERNETIP_ADAPTER_FWHAL.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">EtherNet/IP Adapter FWHAL </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md662">Introduction</a></li>
<li class="level1"><a href="#autotoc_md663">PRU-ICSS EtherNet/IP Adapter Firmware</a><ul><li class="level2"><a href="#autotoc_md664">Features Supported</a></li>
<li class="level2"><a href="#autotoc_md665">Known Issues</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md666">Important Files and Directory Structure</a></li>
<li class="level1"><a href="#autotoc_md667">Terms and Abbreviations</a></li>
<li class="level1"><a href="#autotoc_md668">API Documentation</a></li>
<li class="level1"><a href="#autotoc_md669">Procedure to kick-off the EtherNet/IP Adapter</a></li>
<li class="level1"><a href="#autotoc_md670">Integration with ICSS-EMAC</a><ul><li class="level2"><a href="#autotoc_md671">Interface with ICSS-EMAC</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md672">Interrupts</a></li>
<li class="level1"><a href="#autotoc_md673">Device Level Ring</a></li>
<li class="level1"><a href="#autotoc_md674">IEEE PTP-1588 Implementation</a></li>
<li class="level1"><a href="#ETHERNETIP_ADAPTER_ADDITIONAL_REFERENCES">Additional References</a></li>
<li class="level1"><a href="#autotoc_md675">See also</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_industrial_comms_ethernetip_adapter"></a></p>
<h1><a class="anchor" id="autotoc_md662"></a>
Introduction</h1>
<p>This software is designed for the TI SoCs with PRU-ICSS IP to enable customers add EtherNet/IP Adapter protocol support to their system. It implements EtherNet/IP + PTP + DLR functionality and provides EtherNet/IP ASIC like functionality integrated into TI SoCs.</p>
<div class="image">
<img src="EtherNetIP_Adapter_Software_Architecture.PNG" alt=""/>
<div class="caption">
Software Architecture</div></div>
<p>EtherNet/IP firmware for PRU-ICSS is a black box product maintained by TI. EtherNet/IP Adapter FWHAL(Firmware and Hardware Abstraction Layer) allows loading and run EtherNet/IP firmware and acts as an interface with the firmware. FWHAL implements the key interface between EtherNet/IP Adapter firmware and EtherNet/IP Adapter stack.</p>
<h1><a class="anchor" id="autotoc_md663"></a>
PRU-ICSS EtherNet/IP Adapter Firmware</h1>
<h2><a class="anchor" id="autotoc_md664"></a>
Features Supported</h2>
<ul>
<li>Integrated two-port cut-through switch<ul>
<li>100 Mbps, 10Mbps</li>
<li>Full Duplex, Half Duplex</li>
</ul>
</li>
<li>Quality of Service (QoS)<ul>
<li>Four priority receive queues on host port, each queue 6 KB in size</li>
<li>Four priority transmit queues on each physical port, each queue 3 KB in size</li>
</ul>
</li>
<li>DLR â€“ Device Level Ring<ul>
<li>200us beacon interval</li>
<li>400us beacon timeout</li>
<li>Self-Configuring</li>
</ul>
</li>
<li>PTP/1588 - Time Synchronization<ul>
<li>E2E mode supported</li>
<li>CIP Sync capable</li>
<li>Transparent and Ordinary Clock</li>
</ul>
</li>
<li>1 ms buffering per port</li>
<li>802.1d learning bridge for received source MAC addresses<ul>
<li>1024 addresses per port</li>
<li>APIs for port state configuration and flushing learning table upon change in network topology</li>
<li>Switch address learned table (FDB) is flushed in 2.4 us</li>
</ul>
</li>
<li>Multicast and Broadcast storm prevention per port</li>
<li>Interrupt for Link loss detection<ul>
<li>Callback APIs to perform tasks related to change in network topology</li>
</ul>
</li>
<li>Statistics<ul>
<li>Media counters supported per port</li>
<li>Interface counters supported per port</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md665"></a>
Known Issues</h2>
<table class="doxtable">
<tr>
<th>Record ID </th><th>Details </th><th>Workaround  </th></tr>
<tr>
<td>PINDSW-4982 </td><td>SQE and Carrier Sense Errors counters not supported in EtherNet/IP </td><td><p class="starttd">- </p>
<p class="endtd"></p>
</td></tr>
</table>
<h1><a class="anchor" id="autotoc_md666"></a>
Important Files and Directory Structure</h1>
<table class="doxtable">
<tr>
<th>Folder/Files </th><th>Description  </th></tr>
<tr>
<td colspan="2" bgcolor="#F0F0F0">${SDK_INSTALL_PATH}/examples/industrial_comms </td></tr>
<tr>
<td>ethernetip_adapter_demo </td><td>EtherNet/IP Adapter Examples (based on pre-integrated stack)  </td></tr>
<tr>
<td colspan="2" bgcolor="#F0F0F0">${SDK_INSTALL_PATH}/source/industrial_comms/ethernetip_adapter </td></tr>
<tr>
<td>icss_fwhal/firmware </td><td>Firmware for the PRU cores in PRU-ICSS. <b>Firmware Version : 5.2.7</b>   </td></tr>
<tr>
<td>icss_fwhal/lib/ </td><td>FWHAL library for EtherNet/IP Adapter  </td></tr>
<tr>
<td>icss_fwhal/*.c </td><td>FWHAL source files  </td></tr>
<tr>
<td>icss_fwhal/*.h </td><td>FWHAL interface files  </td></tr>
<tr>
<td>stack </td><td><p class="starttd">Stack header files and stack library </p>
<p class="endtd"></p>
</td></tr>
</table>
<h1><a class="anchor" id="autotoc_md667"></a>
Terms and Abbreviations</h1>
<table class="doxtable">
<tr>
<th>Abbreviation </th><th>Expansion  </th></tr>
<tr>
<td>PRU-ICSS </td><td>Programmable Real-Time Unit Industrial Communication Subsystem  </td></tr>
<tr>
<td>DLR </td><td>Device Level Ring (A redundancy protocol)  </td></tr>
<tr>
<td>PTP </td><td>Precision Time Protocol  </td></tr>
<tr>
<td>OC </td><td>Ordinary Clock  </td></tr>
<tr>
<td>TC </td><td>Transparent Clock  </td></tr>
<tr>
<td>E2E </td><td>End to End  </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md668"></a>
API Documentation</h1>
<p>Please see <a class="el" href="group__INDUSTRIAL__COMMS__ETHERNETIP__ADAPTER__FWHAL__MODULE.html">APIs for EtherNet/IP Adapter FWHAL</a> for API documentation. It is recommended to use these FWHAL APIs in the stack adaptation files.</p>
<h1><a class="anchor" id="autotoc_md669"></a>
Procedure to kick-off the EtherNet/IP Adapter</h1>
<ul>
<li>Initialize ICSS-EMAC to work as a switch</li>
<li>Initialize the required tasks and interrupts</li>
<li>Initialize the EtherNet/IP FWHAL, PTP, DLR and PRU-ICSS INTC</li>
<li>Register the callbacks</li>
<li>Load EtherNet/IP firmware into PRUs of PRU-ICSS</li>
<li>Initialize the EtherNet/IP slave stack</li>
<li>Start firmware</li>
<li>Handle the events as needed. The Event/ISR definitions are available in developer guide(provide a link here), these have respective callbacks that can be registered to custom stack APIs.</li>
</ul>
<h1><a class="anchor" id="autotoc_md670"></a>
Integration with ICSS-EMAC</h1>
<p>Ethernet/IP Adapter examples uses the ICSS-EMAC as its base switch layer. The PRU Firmware provides switch functionality and additional PTP and DLR functionalities. The NRT(non-real time) traffic is handled by ICSS-EMAC, wherein the packets are forwarded either to the TCP stack or a custom callback (configurable in ICSS-EMAC).</p>
<h2><a class="anchor" id="autotoc_md671"></a>
Interface with ICSS-EMAC</h2>
<p>Ethernet/IP packets are standard ethernet frames and all protocol specific data is embedded in TCP/IP payload. Hence the standard switch model applies. Packets are segregated based on VLAN PCP field. The 8 priorities which map to 4 queues, with highest and next highest priorities going to Queue 0 and Queue 1 and so on. If PCP field does not exist, then frames go to Queue 3. All queues except the highest priority queue forward the frames to TCP/IP stack. Further if packet type does not match PTP or DLR then that frame goes to TCP/IP stack. The highest priority queues are used for PTP and DLR. These packets are directly forwarded to the registered callback in ICSS-EMAC (using rxRTCallBack).</p>
<h1><a class="anchor" id="autotoc_md672"></a>
Interrupts</h1>
<p>EtherNet/IP firmware generates the following interrupts.</p>
<p>8 Host Interrupts (Host Interrupts 2 through 9) are exported from the PRU_ICSSG internal INTC for signaling the device level interrupt controllers. PRU_EVTOUT0 to PRU_EVTOUT7 correspond to these eight interrupts in the following table. Please check <a class="el" href="DRIVERS_PRUICSS_PAGE.html#PRUICSS_INTC">PRUICSS Interrupt Controller</a> section for more details.</p>
<table class="doxtable">
<tr>
<th>Name </th><th>Host Interrupt </th><th>Description  </th></tr>
<tr>
<td>Frame Receive </td><td>PRU_EVTOUT0 </td><td>Notifies host when firmware has stored a frame in host receive queue  </td></tr>
<tr>
<td>DLR Port 0 Interrupt </td><td>PRU_EVTOUT1 </td><td>Raised when there is a state change in DLR on Port 0  </td></tr>
<tr>
<td>DLR Port 1 Interrupt </td><td>PRU_EVTOUT2 </td><td>Raised when there is a state change in DLR on Port 1  </td></tr>
<tr>
<td>Tx Callback Interrupt </td><td>PRU_EVTOUT3 </td><td>Raised when a PTP/1588 frame which requires Tx Timestamping is sent out  </td></tr>
<tr>
<td>DLR Beacon Timeout Interrupt for Port 0 </td><td>PRU_EVTOUT4 </td><td>Raised when the beacon timeout timer on Port 0 expires  </td></tr>
<tr>
<td>DLR Beacon Timeout Interrupt for Port 1 </td><td>PRU_EVTOUT7 </td><td>Raised when the beacon timeout timer on Port 1 expires  </td></tr>
<tr>
<td>Link Change </td><td>PRU_EVTOUT6 </td><td>Interrupt is raised when the link on Ethernet PHY comes up or goes down  </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md673"></a>
Device Level Ring</h1>
<p>Device Level Ring on EtherNet/IP firmware provides redundancy to the switch implementation. It is a beacon based implementation with support for a minimum beacon of 200us and timeout of 400us. More information is available in developer guide(provide a link here).</p>
<h1><a class="anchor" id="autotoc_md674"></a>
IEEE PTP-1588 Implementation</h1>
<p>PTP/1588 on EtherNet/IP provides time synchronization support. The implementation is driven by CIP Sync requirements which require End to End clock support over UDP (Annex D). EtherNet/IP adapter application supports both OC and TC implementations along with syntonization.</p>
<h1><a class="anchor" id="ETHERNETIP_ADAPTER_ADDITIONAL_REFERENCES"></a>
Additional References</h1>
<p>Please refer to below documents to understand more about EtherNet/IP Adapter on TI platforms and EtherNet/IP Adapter protocol specifications.</p>
<table class="doxtable">
<tr>
<th>Document </th><th>Description  </th></tr>
<tr>
<td><a href="https://www.ti.com/lit/pdf/spry249">EtherNet/IP on TI's Sitara processors</a> </td><td>Application note by TI on the EtherNet/IP Adapter implementation on TI's Sitara Processors.  </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md675"></a>
See also</h1>
<ul>
<li><a class="el" href="EXAMPLES_INDUSTRIAL_COMMS_ETHERNETIP_ADAPTER_DEMOS.html">EtherNet/IP Adapter Demos</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
