<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: XIP Benchmark</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">08.01.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_KERNEL_DPL_XIP_BENCHMARK.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">XIP Benchmark </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md837">Introduction</a></li>
<li class="level1"><a href="#autotoc_md838">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md839">Steps to Run the Example</a></li>
<li class="level1"><a href="#autotoc_md840">See Also</a></li>
<li class="level1"><a href="#autotoc_md841">Sample Output</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_kernel_xip_benchmark"></a></p>
<h1><a class="anchor" id="autotoc_md837"></a>
Introduction</h1>
<p>This example shows a application running in XIP (eXecute In Place) mode. This example can be used to check and evaluate the performance of the SOC when running in XIP mode.</p>
<p>The example does the below</p><ul>
<li>SOC is booted to run applications for multiple CPUs</li>
<li>The bootloader configures the flash at highest possible speed and highest throughput mode.</li>
<li>On AM64X, this means, the flash is in<ul>
<li>Direct access (DAC) mode for read</li>
<li>Dual data rate (DDR) mode</li>
<li>OSPI and flash at 133Mhz clock speed</li>
<li>OSPI Phy enable</li>
<li>OSPI Phy pipeline enabled.</li>
</ul>
</li>
<li>All the CPUs are configured to run FreeRTOS with below functions being executed.<ul>
<li>FIR function, here, code, input data and coeff data is kept in flash</li>
<li>memcpy function, here, code, input data is kept in flash</li>
</ul>
</li>
<li>The linker command file of the CPUs is setup so that code and rodata is execute and referenced from flash.</li>
<li>An MPU entry is setup at each CPU, to enable execute from flahs region with cache enabled.</li>
<li>Each function is run multiple times and the worst case, best case and average case performance is printed on the UART terminal in units of cycles.</li>
<li>There is a compile time flag <code>ENABLE_CPU_SYNC</code> to "sync" all the CPUs such that all execute and access the code and data from flash at the approximately the same time. This allows to simulate the worst case simultaneous access to the flash device in multi CPU environment. <b>NOTE</b>, by default, <code>ENABLE_CPU_SYNC</code> is <code>0</code>, i.e the CPUs are not synced.</li>
</ul>
<h1><a class="anchor" id="autotoc_md838"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" rowspan="4">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0 freertos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">r5fss0-1 freertos   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">r5fss1-0 freertos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">r5fss1-1 freertos   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Board  </td><td class="markdownTableBodyNone">am64x-evm   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/kernel/dpl/xip_benchmark/   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md839"></a>
Steps to Run the Example</h1>
<dl class="section note"><dt>Note</dt><dd>This is a <code>system</code> or multi-core project, so refer to system project build instructions for CCS project or makefiles when building the example.</dd></dl>
<ul>
<li><b>When using CCS projects to build</b>, import the system CCS project and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>). This will build all the dependant CPU projects as well</li>
<li><b>When using makefiles to build</b>, build the system makefile using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>). This will build all the dependant CPU makefiles as well.</li>
<li>This program cannot be loaded and run from CCS since it expects some sections of code/data to reside in flash</li>
<li>To flash this program use the sample config file located at below. <pre class="fragment">  examples/kernel/dpl/xip_benchmark/am64x-evm/system_freertos/sbl_ospi.cfg
</pre></li>
<li>This config file has the filenames listed assuming application is built using makefile's and release profile. If you are using CCS projects or debug profile, edit this file to point to appropriate files.</li>
<li>Now flash to EVM using the steps mention here, only use the config file mentioned above, <a class="el" href="GETTING_STARTED_FLASH.html">Flash a Hello World example</a></li>
<li>This is a multi-core example. Above steps will flash applications for all the CPUs.</li>
</ul>
<h1><a class="anchor" id="autotoc_md840"></a>
See Also</h1>
<p><a class="el" href="BOOTFLOW_XIP.html">Enabling XIP or eXecute In Place</a></p>
<h1><a class="anchor" id="autotoc_md841"></a>
Sample Output</h1>
<p>Shown below is a screenshot, after R5F is halted and symbols loaded, on AM64x. You can see the code execution is at flash region (<code>0x60xxxxxx</code>).</p>
<p> <style>div.image img[src="xip_benchmark.png"]{width:50%}</style> </p><div class="image">
<img src="xip_benchmark.png" alt=""/>
<div class="caption">
Code execution in XIP</div></div>
<p>Shown below is a sample output when the application is run on am64x-evm,</p>
<div class="fragment"><div class="line">Starting OSPI Bootloader ...</div>
<div class="line"> </div>
<div class="line">DMSC Firmware Version 21.1.1--v2021.01a (Terrific Lla</div>
<div class="line">DMSC Firmware revision 0x15</div>
<div class="line">DMSC ABI revision 3.1</div>
<div class="line"> </div>
<div class="line">INFO: Bootloader_loadSelfCpu:203: CPU r5f0-0 is initialized to 800000000 Hz !!!</div>
<div class="line">INFO: Bootloader_loadSelfCpu:203: CPU r5f0-1 is initialized to 800000000 Hz !!!</div>
<div class="line">INFO: Bootloader_runCpu:151: CPU m4f0-0 is initialized to 400000000 Hz !!!</div>
<div class="line">INFO: Bootloader_runCpu:151: CPU r5f1-0  is initialized to 800000000 Hz !!!</div>
<div class="line">INFO: Bootloader_runCpu:151: CPU r5f1-1 is initialized to 800000000 Hz !!!</div>
<div class="line">INFO: Bootloader_runSelfCpu:215: All done, reseting self ...</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">### XIP benchmark ###</div>
<div class="line">[r5f0-1]     0.000387s :</div>
<div class="line">[r5f0-1]     0.000450s : ### XIP benchmark ###</div>
<div class="line">[r5f0-1]     0.000871s : FIR:</div>
<div class="line">[r5f0-1]     0.000880s :   26721 cycles (code/data fully cached) ,</div>
<div class="line">[r5f0-1]     0.000895s :   59814 cycles (code/data not cached) ,</div>
<div class="line">[r5f0-1]     0.000908s :   30033 cycles (code/data not-cached 1 of 10 iterations)</div>
<div class="line">[r5f0-1]     0.000960s : MEMCPY:</div>
<div class="line">[r5f0-1]     0.000966s :    1564 cycles (code/data fully cached) ,</div>
<div class="line">[r5f0-1]     0.000979s :    5073 cycles (code/data not cached) ,</div>
<div class="line">[r5f0-1]     0.000992s :    1919 cycles (code/data not-cached 1 of 10 iterations)</div>
<div class="line">[r5f0-1]     0.001018s : All tests have passed!!</div>
<div class="line">[r5f0-1]     0.001029s :</div>
<div class="line">[r5f1-0]     0.000386s :</div>
<div class="line">[r5f1-0]     0.000449s : ### XIP benchmark ###</div>
<div class="line">[r5f1-0]     0.000871s : FIR:</div>
<div class="line">[r5f1-0]     0.000878s :   26721 cycles (code/data fully cached) ,</div>
<div class="line">[r5f1-0]     0.000893s :   60349 cycles (code/data not cached) ,</div>
<div class="line">[r5f1-0]     0.000906s :   30086 cycles (code/data not-cached 1 of 10 iterations)</div>
<div class="line">[r5f1-0]     0.000958s : MEMCPY:</div>
<div class="line">[r5f1-0]     0.000966s :    1564 cycles (code/data fully cached) ,</div>
<div class="line">[r5f1-0]     0.000979s :    5002 cycles (code/data not cached) ,</div>
<div class="line">[r5f1-0]     0.000991s :    1911 cycles (code/data not-cached 1 of 10 iterations)</div>
<div class="line">[r5f1-0]     0.001017s : All tests have passed!!</div>
<div class="line">[r5f1-0]     0.001027s :</div>
<div class="line">[r5f1-1]     0.000384s :</div>
<div class="line">[r5f1-1]     0.000446s : ### XIP benchmark ###</div>
<div class="line">[r5f1-1]     0.000869s : FIR:</div>
<div class="line">[r5f1-1]     0.000876s :   26721 cycles (code/data fully cached) ,</div>
<div class="line">[r5f1-1]     0.000891s :   60298 cycles (code/data not cached) ,</div>
<div class="line">[r5f1-1]     0.000904s :   30081 cycles (code/data not-cached 1 of 10 iterations)</div>
<div class="line">[r5f1-1]     0.000956s : MEMCPY:</div>
<div class="line">[r5f1-1]     0.000963s :    1564 cycles (code/data fully cached) ,</div>
<div class="line">[r5f1-1]     0.000976s :    5057 cycles (code/data not cached) ,</div>
<div class="line">[r5f1-1]     0.000988s :    1916 cycles (code/data not-cached 1 of 10 iterations)</div>
<div class="line">[r5f1-1]     0.001014s : All tests have passed!!</div>
<div class="line">[r5f1-1]     0.001024s :</div>
<div class="line">FIR:</div>
<div class="line">  26721 cycles (code/data fully cached) ,</div>
<div class="line">  58646 cycles (code/data not cached) ,</div>
<div class="line">  30119 cycles (code/data not-cached 1 of 10 iterations)</div>
<div class="line">MEMCPY:</div>
<div class="line">   1564 cycles (code/data fully cached) ,</div>
<div class="line">   4179 cycles (code/data not cached) ,</div>
<div class="line">   1830 cycles (code/data not-cached 1 of 10 iterations)</div>
<div class="line">All tests have passed!!</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
