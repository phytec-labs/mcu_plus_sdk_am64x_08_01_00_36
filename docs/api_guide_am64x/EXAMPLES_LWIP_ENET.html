<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: LwIP with Ethernet Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">08.01.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_LWIP_ENET.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">LwIP with Ethernet Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md1080">Introduction</a></li>
<li class="level1"><a href="#autotoc_md1081">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md1082">Steps to Run the Example</a><ul><li class="level2"><a href="#autotoc_md1083">Build the example</a></li>
<li class="level2"><a href="#autotoc_md1084">HW Setup</a><ul><li class="level3"><a href="#autotoc_md1085">AM64X-EVM</a><ul><li class="level4"><a href="#autotoc_md1086">For CPSW based example</a></li>
<li class="level4"><a href="#autotoc_md1087">For ICSS based example</a></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md1088">Create a network between EVM and host PC</a></li>
<li class="level2"><a href="#autotoc_md1089">Run the example</a></li>
<li class="level2"><a href="#autotoc_md1090">Sample output for CPSW example</a></li>
<li class="level2"><a href="#autotoc_md1091">Sample output for ICSS example</a></li>
<li class="level2"><a href="#autotoc_md1092">Communicate with the EVM using ethernet</a></li>
<li class="level2"><a href="#autotoc_md1093">Troubleshooting issues</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md1094">See Also</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_networking_enet_lwip_example"></a></p>
<h1><a class="anchor" id="autotoc_md1080"></a>
Introduction</h1>
<dl class="section note"><dt>Note</dt><dd>lwIP features are made available as is from public lwIP project. SDK configuration may only enable and exercise a subset of these features.</dd></dl>
<p>This example is a TCP/UDP IP application using the LwIP networking stack, coupled with ethernet driver (ENET)</p>
<p>On AM64X, we can do ethernet based communication using two different underlying HW mechanisms</p>
<ul>
<li>CPSW<ul>
<li>This is a standard ethernet switch + port HW</li>
</ul>
</li>
<li>ICSS<ul>
<li>This is a firmware enabled ethernet switch + port HW</li>
<li>This HW can be used with industrial communication protocols as well (see <a class="el" href="EXAMPLES_INDUSTRIAL_COMMS.html">Industrial Communications Toolkit</a>)</li>
<li>In this example we use ICSS as a standard ethernet port</li>
</ul>
</li>
</ul>
<p>Both use the same ethernet driver underneath with LwIP TCP/IP networking stack</p>
<p>The examples do below</p><ul>
<li>Initializes the ethernet driver for the underlying HW</li>
<li>Initializes the LwIP stack for TCP/UDP IP</li>
<li>Allows user to run and test basic networking features like DHCP, ping, iperf with TCP/UDP.</li>
</ul>
<h1><a class="anchor" id="autotoc_md1081"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0_freertos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Board  </td><td class="markdownTableBodyNone">am64x-evm   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone" rowspan="2">Example folder  </td><td class="markdownTableBodyNone">examples/networking/lwip/enet_lwip_cpsw   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">examples/networking/lwip/enet_lwip_icssg   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md1082"></a>
Steps to Run the Example</h1>
<h2><a class="anchor" id="autotoc_md1083"></a>
Build the example</h2>
<ul>
<li>When using CCS projects to build, import the CCS project for the required combination and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li>When using makefiles to build, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
</ul>
<h2><a class="anchor" id="autotoc_md1084"></a>
HW Setup</h2>
<dl class="section note"><dt>Note</dt><dd>Make sure you have setup the EVM with cable connections as shown here, <a class="el" href="EVM_SETUP_PAGE.html">EVM Setup</a>. In addition do below steps.</dd></dl>
<h3><a class="anchor" id="autotoc_md1085"></a>
AM64X-EVM</h3>
<h4><a class="anchor" id="autotoc_md1086"></a>
For CPSW based example</h4>
<ul>
<li>Connect a ethernet cable to the EVM from host PC as shown below</li>
</ul>
<p> <style>div.image img[src="am64x_evm_lwip_example_00.png"]{width:30%}</style> </p><div class="image">
<img src="am64x_evm_lwip_example_00.png" alt=""/>
<div class="caption">
Ethernet cable for CPSW based ethernet</div></div>
<h4><a class="anchor" id="autotoc_md1087"></a>
For ICSS based example</h4>
<ul>
<li>Connect a ethernet cable to the EVM from host PC as shown below</li>
</ul>
<p> <style>div.image img[src="am64x_evm_lwip_example_01.png"]{width:30%}</style> </p><div class="image">
<img src="am64x_evm_lwip_example_01.png" alt=""/>
<div class="caption">
Ethernet cable for ICSS based ethernet</div></div>
<h2><a class="anchor" id="autotoc_md1088"></a>
Create a network between EVM and host PC</h2>
<ul>
<li>The EVM will get an IP address using DHCP, so make sure to connect the other end of the cable to a network which has a DHCP server running.</li>
<li>To get started one can create a simple local network between the EVM and the host PC by using a home broadband/wifi router as shown below. Most such routers run a DHCP server</li>
</ul>
<p> <style>div.image img[src="lwip_example_01.png"]{width:30%}</style> </p><div class="image">
<img src="lwip_example_01.png" alt=""/>
<div class="caption">
Local network between PC and EVM</div></div>
<ul>
<li>To check the router connection with host PC, recommend to disconnect all other networking conenctions on the PC, sometimes you may need to disable firewall SW, and make sure the router is able to assign a IP address to your host PC</li>
<li>After we run the example on the EVM (next step), the EVM will similarly be assigned a IP address, and then host can communicate with the EVM using the assigned IP address.</li>
</ul>
<h2><a class="anchor" id="autotoc_md1089"></a>
Run the example</h2>
<dl class="section attention"><dt>Attention</dt><dd>If you need to reload and run again, a CPU power-cycle is MUST</dd></dl>
<ul>
<li>Launch a CCS debug session and run the example executable, see <a class="el" href="CCS_LAUNCH_PAGE.html">CCS Launch, Load and Run</a></li>
<li>You will see logs in the UART terminal as shown in the next section.</li>
<li>Note the IP address seen in the log, this is what we will use to communicate with the EVM.</li>
</ul>
<h2><a class="anchor" id="autotoc_md1090"></a>
Sample output for CPSW example</h2>
<div class="fragment"><div class="line">==========================</div>
<div class="line">      ENET LWIP App</div>
<div class="line">==========================</div>
<div class="line">Enabling clocks!</div>
<div class="line">Starting lwIP, local interface IP is dhcp-enabled</div>
<div class="line">EnetAppUtils_reduceCoreMacAllocation: Reduced Mac Address Allocation for CoreId:1 From 8 To 1</div>
<div class="line">CPSW_3G Test on MAIN NAVSS</div>
<div class="line">EnetPhy_bindDriver: PHY 0: OUI:080028 Model:23 Ver:01 &lt;-&gt; &#39;dp83867&#39; : OK</div>
<div class="line">PHY 0 is alive</div>
<div class="line">Host MAC address: f4:84:4c:f9:4d:29</div>
<div class="line">[LWIPIF_LWIP] CPSW has been started successfully</div>
<div class="line">[LWIPIF_LWIP] NETIF INIT SUCCESS</div>
<div class="line">status_callback==UP, local interface IP is 0.0.0.0</div>
<div class="line">UDP server listening on port 5001</div>
<div class="line">Cpsw_handleLinkUp: Port 1: Link up: 100-Mbps Full-Duplex</div>
<div class="line">MAC Port 1: link up</div>
<div class="line">link_callback==UP</div>
<div class="line">status_callback==UP, local interface IP is 192.168.1.100</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1091"></a>
Sample output for ICSS example</h2>
<div class="fragment"><div class="line">==========================</div>
<div class="line">      ENET LWIP App</div>
<div class="line">==========================</div>
<div class="line">Enabling clocks!</div>
<div class="line">Starting lwIP, local interface IP is dhcp-enabled</div>
<div class="line">ICSSG Dual MAC Test</div>
<div class="line">PHY 3 is alive</div>
<div class="line">Host MAC address: 70:ff:76:1d:92:c1</div>
<div class="line">[LWIPIF_LWIP] CPSW has been started successfully</div>
<div class="line">[LWIPIF_LWIP] NETIF INIT SUCCESS</div>
<div class="line">status_callback==UP, local interface IP is 0.0.0.0</div>
<div class="line">UDP server listening on port 5001</div>
<div class="line">EnetPhy_bindDriver: PHY 15: OUI:080028 Model:0f Ver:01 &lt;-&gt; &#39;dp83867&#39; : OK</div>
<div class="line">Icssg_handleLinkUp: icssg1-1: Port 1: Link up: 100-Mbps Full-Duplex</div>
<div class="line">link_callback==UP</div>
<div class="line">status_callback==UP, local interface IP is 192.168.1.101</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md1092"></a>
Communicate with the EVM using ethernet</h2>
<ul>
<li>Firstly you can try to reach the EVM using ping as shown below, using a command shell on the host PC <pre class="fragment">  &gt; ping 192.168.1.100
</pre></li>
<li>Next you can run <code>iperf</code> tests as shown below. Below steps have been tried with a Linux Ubuntu 18.04 host PC running bash shell<ul>
<li>Install <code>iperf</code> if not installed by doing below <pre class="fragment"> &gt; sudo apt install iperf
</pre></li>
<li>Invoke iperf to test TCP bi-directional RX+TX connection as shown below <div class="fragment"><div class="line">&gt; iperf -c 192.168.1.100 -i 5 -t 20 -d</div>
</div><!-- fragment --></li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md1093"></a>
Troubleshooting issues</h2>
<ul>
<li>If you see MAC address as <code>00:00:00:00:00:00</code>, likely you are using a very early Si sample which does not have MAC address "fused" in, in this case do below steps<ul>
<li>Open file <code>source\networking\enet\soc\j7x\am64x_am243x\enet_soc.c</code></li>
<li>Uncomment below line <div class="fragment"><div class="line">#define ENET_MAC_ADDR_HACK (TRUE)</div>
</div><!-- fragment --></li>
<li>Rebuild the libraries and examples (<a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
</ul>
</li>
<li>If you see a valid, non-zero MAC address but IP address is <code>0.0.0.0</code> then<ul>
<li>Make sure you see <code>link_callback==UP</code> message, if not check the ethernet cable</li>
<li>Check the local network and check if the DHCP server is indeed running as expected</li>
<li>When using a home broadband/wifi router, its possible to check the clients connected to the DHCP server via a web browser. Check your router user manual for more details.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md1094"></a>
See Also</h1>
<p><a class="el" href="NETWORKING.html">Networking</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
