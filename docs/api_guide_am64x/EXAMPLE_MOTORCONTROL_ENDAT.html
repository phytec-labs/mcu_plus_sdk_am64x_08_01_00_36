<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: EnDAT Diagnostic</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">08.01.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLE_MOTORCONTROL_ENDAT.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">EnDAT Diagnostic </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md863">Introduction</a><ul><li class="level2"><a href="#autotoc_md864">Features Supported</a></li>
<li class="level2"><a href="#autotoc_md865">SysConfig Features</a></li>
<li class="level2"><a href="#autotoc_md866">Features Not Supported</a></li>
<li class="level2"><a href="#autotoc_md867">Important files and directory structure</a></li>
</ul>
</li>
<li class="level1"><a href="#EXAMPLES_MOTORCONTROL_ENDAT_COMBOS">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md868">Steps to Run the Example</a><ul><li class="level2"><a href="#autotoc_md869">Hardware Prerequisites</a></li>
<li class="level2"><a href="#autotoc_md870">Hardware Setup</a></li>
<li class="level2"><a href="#autotoc_md871">Build, load and run</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md872">Sample Output</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_motorcontrol_endat_example"></a></p>
<h1><a class="anchor" id="autotoc_md863"></a>
Introduction</h1>
<p>EnDat is a bidirectional interface for position encoders. During EnDat operation the EnDat master receives position information from the EnDat position encoder. The EnDat diagnostic application, described here, demonstrates the EnDat master operation.</p>
<p>The EnDat driver provides a well defined set of API's to expose EnDat master interface.</p>
<p>The diagnostic invokes these API's to</p><ul>
<li>initialize EnDat,</li>
<li>configure the host trigger mode,</li>
<li>select between concurrent multi channel or single channel configuration,</li>
<li>select the channel (channels in the case of concurrent multi channel configuration)</li>
<li>and run the firmware.</li>
</ul>
<p>Once these steps are executed,</p><ul>
<li>the driver waits for the EnDat to be initialized.</li>
<li>It then sets clock frequency to 200KHz (as propagation delay is not yet compensated)</li>
<li>and obtains the encoder details including serial number, position resolution etc, and displays on the console.</li>
<li>Based on the whether encoder is 2.2 or 2.1 type, it sets clock to either 8MHz or 1MHz respectively.</li>
<li>While configuring clock, propagation delay is taken care using the automatically estimated propagation delay (user can override it too).</li>
<li>In the case of concurrent multi channel configuration, if propagation delay between various channels are different, that too is automatically taken care.</li>
</ul>
<p>Once initial setup is over,</p><ul>
<li>the diagnostic provides the user with a self explanatory menu.</li>
<li>Two types of menu options are presented. One type (1-14) will send an EnDat command as per EnDat 2.2 specification.</li>
<li>The other type (100-108) allows the user to configure clock frequency, various timing parameters, simulate motor control loop using 2.1 command as well as 2.2 command with safety (redundant position information), switch to continuous clock mode and monitor raw data.</li>
<li>Concurrent multi channel configuration can work simultaneously for up-to three encoders with identical part number, all variants of 2.2 position commands as well as the 2.1 position command is supported and an additional option (109) to configure wire delay (useful when propagation delay in each channel is different) is available.</li>
<li>Application by default, handles wire delay as required, the menu option provides a way to override it.</li>
</ul>
<p>After the user selects an EnDat command,</p><ul>
<li>the diagnostic asks for more details to frame the command and performs a basic sanity check on the user entered values.</li>
<li>Then the EnDat API is invoked to process the command.</li>
<li>The received EnDat is processed &amp; validated using the defined API's. The result is then presented to the user.</li>
</ul>
<h2><a class="anchor" id="autotoc_md864"></a>
Features Supported</h2>
<ul>
<li>PRU Firmware source</li>
<li>EnDat 2.2 command set</li>
<li>EnDat 2.1 command set</li>
<li>Interrupted and continuous clock mode</li>
<li>Clock configuration up to 16MHz</li>
<li>Cable length up to 100m @8MHz</li>
<li>Propagation delay compensation (capable of handling different propagation delay of different channels in concurrent multi channel configuration)</li>
<li>Automatic estimation of propagation delay</li>
<li>Receive on-the-fly CRC verification of position, parameters and additional information</li>
<li>Two modes of operation - host trigger and periodic trigger</li>
<li>Channel select</li>
<li>Concurrent multi channel support (up-to 3 encoders with identical part number @ 8MHz maximum)</li>
</ul>
<h2><a class="anchor" id="autotoc_md865"></a>
SysConfig Features</h2>
<dl class="section note"><dt>Note</dt><dd>It is strongly recommend to use SysConfig where it is available instead of using direct SW API calls. This will help simplify the SW application and also catch common mistakes early in the development cycle.</dd></dl>
<p>SysConfig can be used to configure things mentioned below:</p><ul>
<li>Selecting the ICSSG0PRUx instance.(Tested on ICSSG0-PRU1)</li>
<li>Configuring PINMUX.</li>
</ul>
<h2><a class="anchor" id="autotoc_md866"></a>
Features Not Supported</h2>
<p>In general, peripherals or features not mentioned as part of "Features Supported" section are not supported in this release, including the below</p><ul>
<li>Safety</li>
</ul>
<h2><a class="anchor" id="autotoc_md867"></a>
Important files and directory structure</h2>
<table class="doxtable">
<tr>
<th>Folder/Files </th><th>Description  </th></tr>
<tr>
<td colspan="2" bgcolor="#F0F0F0">${SDK_INSTALL_PATH}/examples/motor_control/endat_diagnostic </td></tr>
<tr>
<td>endat_diagnostic.c </td><td>EnDAT diagnostic application  </td></tr>
<tr>
<td colspan="2" bgcolor="#F0F0F0">${SDK_INSTALL_PATH}/source/motor_control/position_sense/endat </td></tr>
<tr>
<td>firmware/ </td><td>Folder containing EnDAT firmware sources.  </td></tr>
<tr>
<td>driver/ </td><td>EnDAT diagnostic driver.  </td></tr>
</table>
<h1><a class="anchor" id="EXAMPLES_MOTORCONTROL_ENDAT_COMBOS"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0 freertos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ICSSG  </td><td class="markdownTableBodyNone">ICSSG0   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">PRU  </td><td class="markdownTableBodyNone">PRU1   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Board  </td><td class="markdownTableBodyNone">am64x-evm   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/motorcontrol/endat_example   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md868"></a>
Steps to Run the Example</h1>
<h2><a class="anchor" id="autotoc_md869"></a>
Hardware Prerequisites</h2>
<p>Other than the basic EVM setup mentioned in <a class="el" href="EVM_SETUP_PAGE.html">EVM Setup</a>, below additional HW is required to run this demo</p><ul>
<li>EnDAT encoder</li>
<li>TIDA-00179 Universal Digital Interface to Absolute Position Encoders, <a href="http://www.ti.com/tool/TIDA-00179">http://www.ti.com/tool/TIDA-00179</a></li>
<li>TIDEP-01015 3 Axis board</li>
<li>Interface card connecting EVM and TIDEP-01015 3 Axis board</li>
</ul>
<h2><a class="anchor" id="autotoc_md870"></a>
Hardware Setup</h2>
<p> <style>div.image img[src="EnDAT_Connections.png"]{width:40%}</style> </p><div class="image">
<img src="EnDAT_Connections.png" alt=""/>
<div class="caption">
Hardware Setup</div></div>
<h2><a class="anchor" id="autotoc_md871"></a>
Build, load and run</h2>
<ul>
<li><b>When using CCS projects to build</b>, import the CCS project and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li><b>When using makefiles to build</b>, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
<li>Launch a CCS debug session and run the executable, see <a class="el" href="CCS_LAUNCH_PAGE.html">CCS Launch, Load and Run</a></li>
<li>Refer to UART terminal for user interface menu options.</li>
</ul>
<h1><a class="anchor" id="autotoc_md872"></a>
Sample Output</h1>
<p>Shown below is a sample output when the application is run:</p>
<p> <style>div.image img[src="EnDAT_1.png"]{width:60%}</style> </p><div class="image">
<img src="EnDAT_1.png" alt=""/>
<div class="caption">
EnDAT Usage</div></div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
