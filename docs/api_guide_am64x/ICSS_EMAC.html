<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: ICSS-EMAC</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">08.01.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ICSS_EMAC.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ICSS-EMAC </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md715">Introduction</a></li>
<li class="level1"><a href="#autotoc_md716">Features Supported</a></li>
<li class="level1"><a href="#ICSS_EMAC_SYSCONFIG_FEATURES">SysConfig Features</a></li>
<li class="level1"><a href="#autotoc_md717">Features not supported</a></li>
<li class="level1"><a href="#autotoc_md718">Terms and Abbreviations</a></li>
<li class="level1"><a href="#autotoc_md719">ICSS-EMAC Design</a></li>
<li class="level1"><a href="#autotoc_md720">Usage</a><ul><li class="level2"><a href="#autotoc_md721">Enable ICSS-EMAC in SysConfig</a></li>
<li class="level2"><a href="#autotoc_md722">Update linker command file</a></li>
<li class="level2"><a href="#autotoc_md723">Update MPU for the CPU</a></li>
<li class="level2"><a href="#autotoc_md724">Including the header file</a></li>
<li class="level2"><a href="#autotoc_md725">Initializing the Handle</a></li>
<li class="level2"><a href="#autotoc_md726">Sending a Packet</a></li>
<li class="level2"><a href="#autotoc_md727">Receiving a Packet</a></li>
<li class="level2"><a href="#autotoc_md728">IOCTL</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md729">Dependencies</a></li>
<li class="level1"><a href="#autotoc_md730">Debug Guide</a></li>
<li class="level1"><a href="#autotoc_md731">API</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_networking_icss_emac"></a></p>
<h1><a class="anchor" id="autotoc_md715"></a>
Introduction</h1>
<p>The ICSS-EMAC (Industrial Communications Subsystem Ethernet Media Access Controller) driver provide APIs to transmit and receive packets with a firmware based Ethernet switch that has been implemented on PRUICSS cores.</p>
<p>ICSS-EMAC runs on the host processor, provides a well defined set of APIs to configure the firmware, send packets to the firmware and receive packet from the firmware. Industrial Communication Protocol specific firmware (running on PRUICSS cores) implements a 2 port ethernet switch supporting 802.1d at 100 Mbps.</p>
<dl class="section note"><dt>Note</dt><dd>ICSS-EMAC will be supported for use in Profinet Device and EtherNet/IP Adapter examples only.</dd></dl>
<h1><a class="anchor" id="autotoc_md716"></a>
Features Supported</h1>
<ul>
<li>Packet Receieve: Copying packet received from firmware and providing it to TCP/IP stack or upper layer protocols</li>
<li>Packet Transmit: Providing packet from a TCP/IP stack or upper layer protocols to firmware</li>
<li>Storm Prevention</li>
<li>Host Statistics</li>
<li>Learning/Forwarding Data Base</li>
<li>Multicast/VLAN Filtering</li>
<li>Interrupt handling for Rx, Tx and Link</li>
<li>Task Creation for Rx, Tx and Link</li>
</ul>
<h1><a class="anchor" id="ICSS_EMAC_SYSCONFIG_FEATURES"></a>
SysConfig Features</h1>
<dl class="section note"><dt>Note</dt><dd>It is strongly recommend to use SysConfig where it is available instead of using direct SW API calls. This will help simplify the SW application and also catch common mistakes early in the development cycle.</dd></dl>
<ul>
<li>Selecting the PRU-ICSS instance</li>
<li>Selecting port number</li>
<li>Configuring PHY address for the ports</li>
<li>Select queue threshold for separating real-time(RT) and non real-time(NRT) traffic</li>
<li>Specify the size of buffer space</li>
<li>Provide the task priorities for Rx, Tx and Link tasks</li>
</ul>
<h1><a class="anchor" id="autotoc_md717"></a>
Features not supported</h1>
<ul>
<li>Time-triggered send (TTS)</li>
<li>Firmware Learning mode</li>
<li>Timer based Interrupt Pacing support</li>
</ul>
<h1><a class="anchor" id="autotoc_md718"></a>
Terms and Abbreviations</h1>
<table class="doxtable">
<tr>
<th>Abbreviation </th><th>Expansion  </th></tr>
<tr>
<td>PRU-ICSS </td><td>Programmable Real-Time Unit Industrial Communication Subsystem  </td></tr>
<tr>
<td>EMAC </td><td>Ethernet MAC  </td></tr>
<tr>
<td>Rx/Tx </td><td>Packet Receive/Packet Transmit  </td></tr>
<tr>
<td>INTC </td><td>Interrupt Controller  </td></tr>
<tr>
<td>DLR </td><td>Device Level Ring (A redundancy protocol for EtherNet/IP)  </td></tr>
<tr>
<td>Host/CPU/Cortex </td><td>Used interchangeably and refers to the Application Processor  </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md719"></a>
ICSS-EMAC Design</h1>
<p><a class="el" href="ICSS_EMAC_DESIGN.html">ICSS-EMAC Design</a> explains the driver design in detail.</p>
<h1><a class="anchor" id="autotoc_md720"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md721"></a>
Enable ICSS-EMAC in SysConfig</h2>
<ul>
<li>Enable ICSS-EMAC via SysConfig, by selecting <code>ICSS-EMAC</code> under <code>TI NETWORKING</code> in the left pane in SysConfig.</li>
<li>Parameters mentioned in <a class="el" href="ICSS_EMAC.html#ICSS_EMAC_SYSCONFIG_FEATURES">SysConfig Features</a> should be configured as required.</li>
</ul>
<h2><a class="anchor" id="autotoc_md722"></a>
Update linker command file</h2>
<ul>
<li>A shared memory region between CPU and PRU-ICSS needs to be allocated for queues. The size of this region can be configured using "Queue Buffer Size (KB)" option in SysConfig. The value should be configured according to the firmware which will be loaded on PRU-ICSS's cores. Based on the configured size, following code is generated in <code>ti_drivers_config.c</code> file. (This is an example, and exact code will vary based on the configured value in SysConfig).</li>
</ul>
<div class="fragment"><div class="line">/* ICSS EMAC Packet Buffers */</div>
<div class="line">#define ICSS_EMAC_PKT_BUF_1_MEM_SIZE (65536)</div>
<div class="line">uint8_t gIcssEmacPktBufMem1[ICSS_EMAC_PKT_BUF_1_MEM_SIZE] __attribute__((aligned(128), section(&quot;.bss.  icss_emac_pktbuf_mem&quot;)));</div>
</div><!-- fragment --><ul>
<li>The linker command file should include this <code>.bss.icss_emac_pktbuf_mem</code> section and and map it to a memory region, as shown in below snippet. (Only relevant code sections which should be added are shown)</li>
</ul>
<div class="fragment"><div class="line">MEMORY</div>
<div class="line">{</div>
<div class="line">    /* shared memories that is used between ICCS and this core. MARK as cache+sharable */</div>
<div class="line">    ICSS_PKT_BUF_MEM        : ORIGIN = 0x70000000, LENGTH = 0x00010000</div>
<div class="line">}</div>
<div class="line">SECTIONS</div>
<div class="line">{</div>
<div class="line">    /* Packet buffer memory used by ICSS */</div>
<div class="line">    .bss.icss_emac_pktbuf_mem (NOLOAD): {} &gt; ICSS_PKT_BUF_MEM</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md723"></a>
Update MPU for the CPU</h2>
<ul>
<li>The shared memory section (described in the above section) which was put in the linker command file needs to be mapped as <code>Cached+Sharable</code> for the CPU.</li>
<li><p class="startli">This can be done via SysConfig, by adding additional MPU entries using the <code>MPU</code> module under <code>TI DRIVER PORTING LAYER (DPL)</code> in SysConfig. Following is an example:</p>
<div class="image">
<img src="icss_emac_mpu_config.PNG" alt=""/>
</div>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md724"></a>
Including the header file</h2>
<p>Include the below file to access the APIs </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="icss__emac_8h.html">networking/icss_emac/icss_emac.h</a>&gt;</span></div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md725"></a>
Initializing the Handle</h2>
<ul>
<li>PRUICSS handle needs to be initialized before <a class="el" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga3dfa23ace97b9812cbc71184186b8e52">ICSS_EMAC_open</a> and passed using <a class="el" href="structICSS__EMAC__Params.html">ICSS_EMAC_Params</a>.</li>
<li><a class="el" href="structPRUICSS__IntcInitData.html">PRUICSS_IntcInitData</a> should be passed based on the firmware. See <a class="el" href="DRIVERS_PRUICSS_PAGE.html#PRUICSS_INTC">PRUICSS Interrupt Controller</a> page for more details.</li>
<li>ICSS-EMAC needs information about the memory map of firmware which will be used. User needs to provide the same information in the form of <a class="el" href="structICSS__EMAC__FwStaticMmap.html">ICSS_EMAC_FwStaticMmap</a> and <a class="el" href="structICSS__EMAC__FwDynamicMmap.html">ICSS_EMAC_FwDynamicMmap</a> while filling the <a class="el" href="structICSS__EMAC__Params.html">ICSS_EMAC_Params</a> structure. There are some other offsets related to VLAN filtering and multicast filtering, for which the structures <a class="el" href="structICSS__EMAC__FwVlanFilterParams.html">ICSS_EMAC_FwVlanFilterParams</a> and <a class="el" href="structICSS__EMAC__FwMulticastFilterParams.html">ICSS_EMAC_FwMulticastFilterParams</a> should be passed if IOCTL for VLAN and multicast filtering are going to be called. For Profinet and EtherNet/IP firmware, these structures are defined in <code>${SDK_INSTALL_PATH}/source/industrial_comms/profinet_device/icss_fwhal/firmware/icss_emac_mmap.h</code> and <code>${SDK_INSTALL_PATH}/source/industrial_comms/ethernetip_adapter/icss_fwhal/firmware/icss_emac_mmap.h</code> respectively.</li>
<li>Various callback functions can be set using <a class="el" href="structICSS__EMAC__CallBackObject.html">ICSS_EMAC_CallBackObject</a> structure.</li>
<li>Please see <a class="el" href="structICSS__EMAC__Params.html">ICSS_EMAC_Params</a> for information on which members are mandatory. If mandatory options are not passed, <a class="el" href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a> will fail in <a class="el" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga3dfa23ace97b9812cbc71184186b8e52">ICSS_EMAC_open</a>.</li>
</ul>
<div class="fragment"><div class="line"> </div>
<div class="line">    <a class="code" href="group__DRV__PRUICSS__MODULE.html#gafdf3be241ef82d4dd736032e9020f163">PRUICSS_Handle</a>      pruicssHandle;</div>
<div class="line">    <a class="code" href="structICSS__EMAC__Params.html">ICSS_EMAC_Params</a>    icssEmacParams;</div>
<div class="line">    <a class="code" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga6e4ec58e67973e3434b9dcb8d308ec3a">ICSS_EMAC_Handle</a>    icssEmacHandle;</div>
<div class="line"> </div>
<div class="line">    pruicssHandle = <a class="code" href="group__DRV__PRUICSS__MODULE.html#ga6779b9e50b38ea5061d7fe0803956024">PRUICSS_open</a>(CONFIG_PRU_ICSS1);</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a>(pruicssHandle != NULL);</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__NETWORKING__ICSS__EMAC__MODULE.html#gaf08e745caf9f79d4373536de1d4d3ba5">ICSS_EMAC_Params_init</a>(&amp;icssEmacParams);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Fill the icssEmacParams as needed */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*Use CONFIG_ICSS_EMAC1 (as configured in SysConfig) macro as parameter to ICSS_EMAC_open */</span></div>
<div class="line">    icssEmacHandle = <a class="code" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga3dfa23ace97b9812cbc71184186b8e52">ICSS_EMAC_open</a>(CONFIG_ICSS_EMAC1, &amp;icssEmacParams);</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a>(icssEmacHandle != NULL);</div>
<div class="line"> </div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md726"></a>
Sending a Packet</h2>
<div class="fragment"><div class="line">    <a class="code" href="structICSS__EMAC__TxArgument.html">ICSS_EMAC_TxArgument</a>    txArgs;</div>
<div class="line">    int32_t                 status;</div>
<div class="line"> </div>
<div class="line">    txArgs.<a class="code" href="structICSS__EMAC__TxArgument.html#a48ba17f3e671b1cd06782f8f25359553">icssEmacHandle</a> = icssEmacHandle;</div>
<div class="line">    txArgs.<a class="code" href="structICSS__EMAC__TxArgument.html#a6244ed6d272ba2f9d6be234f12a91db8">srcAddress</a> = &amp;testPacketArray[0];</div>
<div class="line">    txArgs.<a class="code" href="structICSS__EMAC__TxArgument.html#a0ef597b1e609c043e360d492fb87e28b">portNumber</a> = <a class="code" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga8149aef84e214698f4c40e3a6290cab1">ICSS_EMAC_PORT_1</a>;</div>
<div class="line">    txArgs.<a class="code" href="structICSS__EMAC__TxArgument.html#a7e916764d26310ca814452ed0f509583">queuePriority</a> = <a class="code" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga5b6a99a438eb9bfde971daa0cdbfc045">ICSS_EMAC_QUEUE4</a>;</div>
<div class="line">    txArgs.<a class="code" href="structICSS__EMAC__TxArgument.html#a83fc759d1a492b80da212d3256c0dc1d">lengthOfPacket</a> = <span class="keyword">sizeof</span>(testPacketArray);</div>
<div class="line"> </div>
<div class="line">    status = <a class="code" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga49a2a061f6f24145004053b005f6e1a5">ICSS_EMAC_txPacket</a>(&amp;txArgs, NULL);</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a>(status == <a class="code" href="group__KERNEL__DPL__SYSTEM.html#ga47e638d7c694e6d42e57b96b071b8a6f">SystemP_SUCCESS</a>);</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md727"></a>
Receiving a Packet</h2>
<p><a class="el" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga6a5967f060e14a11d20eea9cd8b66e5f">ICSS_EMAC_rxPktGet</a> is the API used for receving packets. Refer <a class="el" href="ICSS_EMAC_DESIGN.html#ICSS_EMAC_DESIGN_DATA_PATH_RX">Rx Data Path</a> for more details. Following is an example usage:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">Assume that following callback was registered while passing ICSS_EMAC_Params for ICSS_EMAC_open call</span></div>
<div class="line"><span class="comment">icssEmacParams.callBackObject.rxNRTCallBack.callBack = (ICSS_EMAC_CallBack)nrtCallbackRx;</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="keywordtype">void</span> nrtCallbackRx(<span class="keywordtype">void</span> *icssEmacHandleVoidPtr, <span class="keywordtype">void</span> *queueNum, <span class="keywordtype">void</span> *userArg)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga6e4ec58e67973e3434b9dcb8d308ec3a">ICSS_EMAC_Handle</a>        icssEmacHandle = (<a class="code" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga6e4ec58e67973e3434b9dcb8d308ec3a">ICSS_EMAC_Handle</a>)icssEmacHandleVoidPtr;</div>
<div class="line">    <a class="code" href="structICSS__EMAC__RxArgument.html">ICSS_EMAC_RxArgument</a>    rxArgs;</div>
<div class="line">    int32_t                 packetLength;</div>
<div class="line">    uint8_t                 testPacketArray[<a class="code" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga843b0b5f3d2b781482558ed6537850c9">ICSS_EMAC_MAXMTU</a>];</div>
<div class="line"> </div>
<div class="line">    rxArgs.<a class="code" href="structICSS__EMAC__RxArgument.html#a021f7366b7cf7372c3193270f954d24b">icssEmacHandle</a> = icssEmacHandle;</div>
<div class="line">    rxArgs.<a class="code" href="structICSS__EMAC__RxArgument.html#a3099c33b83769c95ed382b66fe0fbcec">queueNumber</a> = ((uint32_t)(queueNum));</div>
<div class="line">    rxArgs.<a class="code" href="structICSS__EMAC__RxArgument.html#ac688e2c04e3143c076f3cca99f0dd45c">more</a> = 0; <span class="comment">/* Returns more which is set to 1 if there are more frames in the queue */</span></div>
<div class="line">    rxArgs.<a class="code" href="structICSS__EMAC__RxArgument.html#a3cf3706237615f89b8c6cff61755b340">port</a> = 0; <span class="comment">/* Returns port number on which frame was received */</span></div>
<div class="line">    rxArgs.<a class="code" href="structICSS__EMAC__RxArgument.html#ac7fd669e1e5006b7e8f5bce2e763c4f9">destAddress</a> =  (uint32_t)(&amp;testPacketArray[0]);</div>
<div class="line"> </div>
<div class="line">    memset(testPacketArray, 0, <a class="code" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga843b0b5f3d2b781482558ed6537850c9">ICSS_EMAC_MAXMTU</a>);</div>
<div class="line"> </div>
<div class="line">    packetLength = <a class="code" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga6a5967f060e14a11d20eea9cd8b66e5f">ICSS_EMAC_rxPktGet</a>(&amp;rxArgs, NULL);</div>
<div class="line">}</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md728"></a>
IOCTL</h2>
<p>IOCTL implementation is identical to the Unix/Linux based IOCTL calls. They provide the application a convenient method to access driver space parameters or modify them. Users are expected to familiarize themselves with the full list of IOCTL calls so that they can utilize all the features provided.</p>
<p>The API for IOCTL is <a class="el" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga7d6c646018a797be02688b661d62f31c">ICSS_EMAC_ioctl</a>. An IOCTL call uses two parameters to find out which driver function to call internally.</p>
<ol type="1">
<li><code>ioctlCommand</code> : Used to locate the module which should be called. Allowed values are <a class="el" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ICSS_EMAC_IOCTL_COMMANDS">ICSS_EMAC_IOCTL_COMMANDS</a>.</li>
<li><code>ioctlParams</code> : Used to give module specific instructions. <code>ioctlParams</code> consists of<ul>
<li><code>command</code> : Indicates which specific command to execute. Allowed values for <code>ioctlParams.command</code> are <a class="el" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ICSS_EMAC_IOCTL_STORM_PREV_CTRL_COMMANDS">ICSS_EMAC_IOCTL_STORM_PREV_CTRL_COMMANDS</a>, <a class="el" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ICSS_EMAC_IOCTL_LEARNING_CTRL_COMMANDS">ICSS_EMAC_IOCTL_LEARNING_CTRL_COMMANDS</a>, <a class="el" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ICSS_EMAC_IOCTL_STATISTICS_COMMANDS">ICSS_EMAC_IOCTL_STATISTICS_COMMANDS</a>, <a class="el" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ICSS_EMAC_IOCTL_MULTICAST_FILTER_CTRL_COMMANDS">ICSS_EMAC_IOCTL_MULTICAST_FILTER_CTRL_COMMANDS</a>, <a class="el" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ICSS_EMAC_IOCTL_VLAN_FILTER_CTRL_COMMANDS">ICSS_EMAC_IOCTL_VLAN_FILTER_CTRL_COMMANDS</a>.</li>
<li><code>ioctlVal</code> : Sometimes the command may require specific input, this is used to provide that.</li>
</ul>
</li>
</ol>
<p>For example, to disable receive functionality on a port, following code is used.</p>
<div class="fragment"><div class="line">    <a class="code" href="structICSS__EMAC__IoctlCmd.html">ICSS_EMAC_IoctlCmd</a>  ioctlParams;</div>
<div class="line">    uint8_t             ioctlvalue = 0;</div>
<div class="line"> </div>
<div class="line">    ioctlvalue = <a class="code" href="group__NETWORKING__ICSS__EMAC__MODULE.html#gac534d84a6dd0ab2e3fa5e2e0d162d35f">ICSS_EMAC_IOCTL_PORT_CTRL_DISABLE</a>;</div>
<div class="line">    ioctlParams.<a class="code" href="structICSS__EMAC__IoctlCmd.html#a4648aa0bdba23604f14d3bf6bb92f0a2">ioctlVal</a> = &amp;ioctlvalue;</div>
<div class="line">    <a class="code" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga7d6c646018a797be02688b661d62f31c">ICSS_EMAC_ioctl</a>(icssEmacHandle, <a class="code" href="group__NETWORKING__ICSS__EMAC__MODULE.html#gaca9511a9521c0a833ed0483b91c272c9">ICSS_EMAC_IOCTL_PORT_CTRL</a>, (uint8_t)<a class="code" href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga8149aef84e214698f4c40e3a6290cab1">ICSS_EMAC_PORT_1</a>, (<span class="keywordtype">void</span>*)&amp;ioctlParams);</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md729"></a>
Dependencies</h1>
<p>ICSS-EMAC is dependent on the Application/Transport layer for proper functioning. Following dependencies should be handled by the application layer (example) :</p>
<ul>
<li>MDIO Configuration : MDIO Initialization is not done by ICSS-EMAC.</li>
<li>PHY Initialization/Configuration</li>
<li>Learning Module Increment Counter Implementation : If learning is enabled, application needs to call IOCTL with <a class="el" href="group__NETWORKING__ICSS__EMAC__MODULE.html#gafd7c0e0a2d34844e92f7756ab7043aa1">ICSS_EMAC_LEARN_CTRL_INC_COUNTER</a> periodically.</li>
</ul>
<h1><a class="anchor" id="autotoc_md730"></a>
Debug Guide</h1>
<p><a class="el" href="ICSS_EMAC_DEBUG_GUIDE.html">ICSS-EMAC Debug Guide</a> covers the most obvious use cases and debug scenarios encountered while using ICSS-EMAC.</p>
<h1><a class="anchor" id="autotoc_md731"></a>
API</h1>
<p><a class="el" href="group__NETWORKING__ICSS__EMAC__MODULE.html">APIs for ICSS-EMAC</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="agroup__NETWORKING__ICSS__EMAC__MODULE_html_ga5b6a99a438eb9bfde971daa0cdbfc045"><div class="ttname"><a href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga5b6a99a438eb9bfde971daa0cdbfc045">ICSS_EMAC_QUEUE4</a></div><div class="ttdeci">#define ICSS_EMAC_QUEUE4</div><div class="ttdoc">Priority Queue 4.</div><div class="ttdef"><b>Definition:</b> icss_emac.h:143</div></div>
<div class="ttc" id="astructICSS__EMAC__TxArgument_html"><div class="ttname"><a href="structICSS__EMAC__TxArgument.html">ICSS_EMAC_TxArgument</a></div><div class="ttdoc">Tx packet processing information block that needs to passed into call to ICSS_EMAC_TxPacket.</div><div class="ttdef"><b>Definition:</b> icss_emac.h:655</div></div>
<div class="ttc" id="agroup__NETWORKING__ICSS__EMAC__MODULE_html_ga6e4ec58e67973e3434b9dcb8d308ec3a"><div class="ttname"><a href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga6e4ec58e67973e3434b9dcb8d308ec3a">ICSS_EMAC_Handle</a></div><div class="ttdeci">struct ICSS_EMAC_Config_s * ICSS_EMAC_Handle</div><div class="ttdoc">Alias for ICSS EMAC Handle containing base addresses and modules.</div><div class="ttdef"><b>Definition:</b> icss_emac.h:366</div></div>
<div class="ttc" id="astructICSS__EMAC__RxArgument_html"><div class="ttname"><a href="structICSS__EMAC__RxArgument.html">ICSS_EMAC_RxArgument</a></div><div class="ttdoc">Rx packet processing information block that needs to passed into call to ICSS_EMAC_RxPktGet.</div><div class="ttdef"><b>Definition:</b> icss_emac.h:637</div></div>
<div class="ttc" id="astructICSS__EMAC__RxArgument_html_a3099c33b83769c95ed382b66fe0fbcec"><div class="ttname"><a href="structICSS__EMAC__RxArgument.html#a3099c33b83769c95ed382b66fe0fbcec">ICSS_EMAC_RxArgument::queueNumber</a></div><div class="ttdeci">uint8_t queueNumber</div><div class="ttdef"><b>Definition:</b> icss_emac.h:642</div></div>
<div class="ttc" id="agroup__NETWORKING__ICSS__EMAC__MODULE_html_ga49a2a061f6f24145004053b005f6e1a5"><div class="ttname"><a href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga49a2a061f6f24145004053b005f6e1a5">ICSS_EMAC_txPacket</a></div><div class="ttdeci">int32_t ICSS_EMAC_txPacket(const ICSS_EMAC_TxArgument *txArg, void *userArg)</div><div class="ttdoc">API to queue a frame which has to be transmitted on the specified port queue.</div></div>
<div class="ttc" id="astructICSS__EMAC__RxArgument_html_a3cf3706237615f89b8c6cff61755b340"><div class="ttname"><a href="structICSS__EMAC__RxArgument.html#a3cf3706237615f89b8c6cff61755b340">ICSS_EMAC_RxArgument::port</a></div><div class="ttdeci">uint8_t port</div><div class="ttdef"><b>Definition:</b> icss_emac.h:644</div></div>
<div class="ttc" id="agroup__NETWORKING__ICSS__EMAC__MODULE_html_gaf08e745caf9f79d4373536de1d4d3ba5"><div class="ttname"><a href="group__NETWORKING__ICSS__EMAC__MODULE.html#gaf08e745caf9f79d4373536de1d4d3ba5">ICSS_EMAC_Params_init</a></div><div class="ttdeci">void ICSS_EMAC_Params_init(ICSS_EMAC_Params *params)</div><div class="ttdoc">Initialize the parmeters data structure with defaults.</div></div>
<div class="ttc" id="agroup__NETWORKING__ICSS__EMAC__MODULE_html_ga7d6c646018a797be02688b661d62f31c"><div class="ttname"><a href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga7d6c646018a797be02688b661d62f31c">ICSS_EMAC_ioctl</a></div><div class="ttdeci">int32_t ICSS_EMAC_ioctl(ICSS_EMAC_Handle icssEmacHandle, uint32_t ioctlCommand, uint8_t portNo, void *ioctlParams)</div><div class="ttdoc">IOCTL Function for ICSS EMAC.</div></div>
<div class="ttc" id="agroup__NETWORKING__ICSS__EMAC__MODULE_html_gaca9511a9521c0a833ed0483b91c272c9"><div class="ttname"><a href="group__NETWORKING__ICSS__EMAC__MODULE.html#gaca9511a9521c0a833ed0483b91c272c9">ICSS_EMAC_IOCTL_PORT_CTRL</a></div><div class="ttdeci">#define ICSS_EMAC_IOCTL_PORT_CTRL</div><div class="ttdoc">IOCTL select port control APIs command.</div><div class="ttdef"><b>Definition:</b> icss_emac.h:294</div></div>
<div class="ttc" id="astructICSS__EMAC__RxArgument_html_ac688e2c04e3143c076f3cca99f0dd45c"><div class="ttname"><a href="structICSS__EMAC__RxArgument.html#ac688e2c04e3143c076f3cca99f0dd45c">ICSS_EMAC_RxArgument::more</a></div><div class="ttdeci">uint32_t more</div><div class="ttdef"><b>Definition:</b> icss_emac.h:646</div></div>
<div class="ttc" id="astructICSS__EMAC__TxArgument_html_a83fc759d1a492b80da212d3256c0dc1d"><div class="ttname"><a href="structICSS__EMAC__TxArgument.html#a83fc759d1a492b80da212d3256c0dc1d">ICSS_EMAC_TxArgument::lengthOfPacket</a></div><div class="ttdeci">uint16_t lengthOfPacket</div><div class="ttdef"><b>Definition:</b> icss_emac.h:664</div></div>
<div class="ttc" id="astructICSS__EMAC__TxArgument_html_a0ef597b1e609c043e360d492fb87e28b"><div class="ttname"><a href="structICSS__EMAC__TxArgument.html#a0ef597b1e609c043e360d492fb87e28b">ICSS_EMAC_TxArgument::portNumber</a></div><div class="ttdeci">uint8_t portNumber</div><div class="ttdef"><b>Definition:</b> icss_emac.h:660</div></div>
<div class="ttc" id="aicss__emac_8h_html"><div class="ttname"><a href="icss__emac_8h.html">icss_emac.h</a></div></div>
<div class="ttc" id="astructICSS__EMAC__IoctlCmd_html_a4648aa0bdba23604f14d3bf6bb92f0a2"><div class="ttname"><a href="structICSS__EMAC__IoctlCmd.html#a4648aa0bdba23604f14d3bf6bb92f0a2">ICSS_EMAC_IoctlCmd::ioctlVal</a></div><div class="ttdeci">void * ioctlVal</div><div class="ttdef"><b>Definition:</b> icss_emac.h:674</div></div>
<div class="ttc" id="agroup__NETWORKING__ICSS__EMAC__MODULE_html_ga6a5967f060e14a11d20eea9cd8b66e5f"><div class="ttname"><a href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga6a5967f060e14a11d20eea9cd8b66e5f">ICSS_EMAC_rxPktGet</a></div><div class="ttdeci">int32_t ICSS_EMAC_rxPktGet(ICSS_EMAC_RxArgument *rxArg, void *userArg)</div><div class="ttdoc">Retrieves a frame from a host queue and copies it in the allocated stack buffer.</div></div>
<div class="ttc" id="agroup__NETWORKING__ICSS__EMAC__MODULE_html_gac534d84a6dd0ab2e3fa5e2e0d162d35f"><div class="ttname"><a href="group__NETWORKING__ICSS__EMAC__MODULE.html#gac534d84a6dd0ab2e3fa5e2e0d162d35f">ICSS_EMAC_IOCTL_PORT_CTRL_DISABLE</a></div><div class="ttdeci">#define ICSS_EMAC_IOCTL_PORT_CTRL_DISABLE</div><div class="ttdoc">ICSS_EMAC_IOCTL_PORT_CTRL options.</div><div class="ttdef"><b>Definition:</b> icss_emac.h:198</div></div>
<div class="ttc" id="agroup__NETWORKING__ICSS__EMAC__MODULE_html_ga843b0b5f3d2b781482558ed6537850c9"><div class="ttname"><a href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga843b0b5f3d2b781482558ed6537850c9">ICSS_EMAC_MAXMTU</a></div><div class="ttdeci">#define ICSS_EMAC_MAXMTU</div><div class="ttdoc">Maximum Valid size (incl header + VLAN TAG..., no CRC)</div><div class="ttdef"><b>Definition:</b> icss_emac.h:176</div></div>
<div class="ttc" id="agroup__NETWORKING__ICSS__EMAC__MODULE_html_ga3dfa23ace97b9812cbc71184186b8e52"><div class="ttname"><a href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga3dfa23ace97b9812cbc71184186b8e52">ICSS_EMAC_open</a></div><div class="ttdeci">ICSS_EMAC_Handle ICSS_EMAC_open(uint32_t idx, const ICSS_EMAC_Params *params)</div><div class="ttdoc">API to initialize and configure ICSS in MAC/Switch Mode.</div></div>
<div class="ttc" id="agroup__KERNEL__DPL__SYSTEM_html_ga47e638d7c694e6d42e57b96b071b8a6f"><div class="ttname"><a href="group__KERNEL__DPL__SYSTEM.html#ga47e638d7c694e6d42e57b96b071b8a6f">SystemP_SUCCESS</a></div><div class="ttdeci">#define SystemP_SUCCESS</div><div class="ttdoc">Return status when the API execution was successful.</div><div class="ttdef"><b>Definition:</b> SystemP.h:56</div></div>
<div class="ttc" id="agroup__DRV__PRUICSS__MODULE_html_ga6779b9e50b38ea5061d7fe0803956024"><div class="ttname"><a href="group__DRV__PRUICSS__MODULE.html#ga6779b9e50b38ea5061d7fe0803956024">PRUICSS_open</a></div><div class="ttdeci">PRUICSS_Handle PRUICSS_open(uint32_t instance)</div><div class="ttdoc">This function creates the handle for a PRUICSS instance.</div></div>
<div class="ttc" id="astructICSS__EMAC__TxArgument_html_a6244ed6d272ba2f9d6be234f12a91db8"><div class="ttname"><a href="structICSS__EMAC__TxArgument.html#a6244ed6d272ba2f9d6be234f12a91db8">ICSS_EMAC_TxArgument::srcAddress</a></div><div class="ttdeci">const uint8_t * srcAddress</div><div class="ttdef"><b>Definition:</b> icss_emac.h:658</div></div>
<div class="ttc" id="agroup__NETWORKING__ICSS__EMAC__MODULE_html_ga8149aef84e214698f4c40e3a6290cab1"><div class="ttname"><a href="group__NETWORKING__ICSS__EMAC__MODULE.html#ga8149aef84e214698f4c40e3a6290cab1">ICSS_EMAC_PORT_1</a></div><div class="ttdeci">#define ICSS_EMAC_PORT_1</div><div class="ttdoc">Used to specify physical port 1 MII 0 (tx)</div><div class="ttdef"><b>Definition:</b> icss_emac.h:188</div></div>
<div class="ttc" id="astructICSS__EMAC__RxArgument_html_ac7fd669e1e5006b7e8f5bce2e763c4f9"><div class="ttname"><a href="structICSS__EMAC__RxArgument.html#ac7fd669e1e5006b7e8f5bce2e763c4f9">ICSS_EMAC_RxArgument::destAddress</a></div><div class="ttdeci">uint32_t destAddress</div><div class="ttdef"><b>Definition:</b> icss_emac.h:640</div></div>
<div class="ttc" id="astructICSS__EMAC__Params_html"><div class="ttname"><a href="structICSS__EMAC__Params.html">ICSS_EMAC_Params</a></div><div class="ttdoc">ICSS_EMAC Parameters.</div><div class="ttdef"><b>Definition:</b> icss_emac.h:608</div></div>
<div class="ttc" id="agroup__KERNEL__DPL__DEBUG_html_ga552e9055ca7eab5fe6c224c6cd5a9d4c"><div class="ttname"><a href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a></div><div class="ttdeci">#define DebugP_assert(expression)</div><div class="ttdoc">Function to call for assert check.</div><div class="ttdef"><b>Definition:</b> DebugP.h:159</div></div>
<div class="ttc" id="astructICSS__EMAC__IoctlCmd_html"><div class="ttname"><a href="structICSS__EMAC__IoctlCmd.html">ICSS_EMAC_IoctlCmd</a></div><div class="ttdoc">IOCTL command members for configuring switch/EMAC.</div><div class="ttdef"><b>Definition:</b> icss_emac.h:672</div></div>
<div class="ttc" id="agroup__DRV__PRUICSS__MODULE_html_gafdf3be241ef82d4dd736032e9020f163"><div class="ttname"><a href="group__DRV__PRUICSS__MODULE.html#gafdf3be241ef82d4dd736032e9020f163">PRUICSS_Handle</a></div><div class="ttdeci">struct PRUICSS_Config_s * PRUICSS_Handle</div><div class="ttdoc">A handle that is returned from a PRUICSS_open() call. This handle is required for calling other APIs.</div><div class="ttdef"><b>Definition:</b> pruicss/g_v0/pruicss.h:234</div></div>
<div class="ttc" id="astructICSS__EMAC__TxArgument_html_a48ba17f3e671b1cd06782f8f25359553"><div class="ttname"><a href="structICSS__EMAC__TxArgument.html#a48ba17f3e671b1cd06782f8f25359553">ICSS_EMAC_TxArgument::icssEmacHandle</a></div><div class="ttdeci">ICSS_EMAC_Handle icssEmacHandle</div><div class="ttdef"><b>Definition:</b> icss_emac.h:656</div></div>
<div class="ttc" id="astructICSS__EMAC__TxArgument_html_a7e916764d26310ca814452ed0f509583"><div class="ttname"><a href="structICSS__EMAC__TxArgument.html#a7e916764d26310ca814452ed0f509583">ICSS_EMAC_TxArgument::queuePriority</a></div><div class="ttdeci">uint8_t queuePriority</div><div class="ttdef"><b>Definition:</b> icss_emac.h:662</div></div>
<div class="ttc" id="astructICSS__EMAC__RxArgument_html_a021f7366b7cf7372c3193270f954d24b"><div class="ttname"><a href="structICSS__EMAC__RxArgument.html#a021f7366b7cf7372c3193270f954d24b">ICSS_EMAC_RxArgument::icssEmacHandle</a></div><div class="ttdeci">ICSS_EMAC_Handle icssEmacHandle</div><div class="ttdef"><b>Definition:</b> icss_emac.h:638</div></div>
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
