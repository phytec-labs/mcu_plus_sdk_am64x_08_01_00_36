<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: Flashing Tools</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">08.01.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('TOOLS_FLASH.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Flashing Tools </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md770">Introduction</a></li>
<li class="level1"><a href="#autotoc_md771">Tool requirements on host PC</a></li>
<li class="level1"><a href="#autotoc_md772">Important files and folders</a></li>
<li class="level1"><a href="#BASIC_STEPS_TO_FLASH_FILES">Basic steps to flash files</a><ul><li class="level2"><a href="#autotoc_md773">Getting ready to flash</a></li>
<li class="level2"><a href="#autotoc_md774">Flash configuration file</a></li>
<li class="level2"><a href="#autotoc_md775">Flash configuration file for flashing to eMMC</a></li>
<li class="level2"><a href="#autotoc_md776">Flashing the files</a></li>
<li class="level2"><a href="#autotoc_md777">Flash tool options</a></li>
</ul>
</li>
<li class="level1"><a href="#TOOLS_FLASH_ERROR_MESSAGES">Flash tool error messages and solutions</a></li>
<li class="level1"><a href="#autotoc_md778">Detailed sequence of steps that happen when flashing files</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_tools_tools_flash"></a></p>
<h1><a class="anchor" id="autotoc_md770"></a>
Introduction</h1>
<p>Flashing tools allow to flash binaries to the flash on a EVM. UART is used as the transport or interface to send the file to flash to the EVM.</p>
<h1><a class="anchor" id="autotoc_md771"></a>
Tool requirements on host PC</h1>
<ul>
<li>The tool is implemented using python and needs python version 3.x</li>
<li>The tool uses additional python packages as listed below.<ul>
<li>pyserial for UART access on PC</li>
<li>xmodem for the file transfer protocol</li>
<li>tqdm for progress bar when the tool is run</li>
</ul>
</li>
<li>Refer to the page, <a class="el" href="SDK_DOWNLOAD_PAGE.html#INSTALL_PYTHON3">Python3</a> , to install python and the required python packages on your PC.</li>
</ul>
<h1><a class="anchor" id="autotoc_md772"></a>
Important files and folders</h1>
<table class="doxtable">
<tr>
<th>Folder/Files </th><th>Description  </th></tr>
<tr>
<td colspan="2" bgcolor="#F0F0F0">${SDK_INSTALL_PATH}/tools/boot/ </td></tr>
<tr>
<td>uart_uniflash.py </td><td>Flashing tool  </td></tr>
<tr>
<td>sbl_prebuilt/am64x-evm </td><td>Pre-built bootloader images and default flash configuration files for a supported EVM  </td></tr>
<tr>
<td colspan="2" bgcolor="#F0F0F0">${SDK_INSTALL_PATH}/examples/drivers/boot/ </td></tr>
<tr>
<td>sbl_uart_uniflash </td><td>Flashing application that is run on the EVM to receive files to flash  </td></tr>
<tr>
<td>sbl_ospi </td><td>OSPI bootloader application that needs to be flashed at offset 0x0. When in OSPI boot mode, this bootloader application will boot the user application file for all the CPUs  </td></tr>
<tr>
<td>sbl_null </td><td>SOC init bootloader application that can be used to init the SOC when working in CCS IDE environment.  </td></tr>
</table>
<h1><a class="anchor" id="BASIC_STEPS_TO_FLASH_FILES"></a>
Basic steps to flash files</h1>
<h2><a class="anchor" id="autotoc_md773"></a>
Getting ready to flash</h2>
<ul>
<li>Make sure the flashing application (<code>sbl_uart_uniflash</code>), OSPI bootloader (<code>sbl_ospi</code>), and the user application (<code>*.appimage</code>) you want to flash is built for the EVM.<ul>
<li>For every supported EVM pre-built flashing application and OSPI bootloader can be found below <pre class="fragment">{SDK_INSTALL_PATH}/tools/boot/sbl_prebuilt/am64x-evm
</pre></li>
<li>The flashing application and OSPI bootloader source code can be found at below path <pre class="fragment">{SDK_INSTALL_PATH}/tools/examples/drivers/boot
</pre></li>
<li>If you have modified the flashing or bootloader applications, make sure to rebuild these applications and note the path to the <code>.tiimage</code> files that are generated as part of the build.</li>
<li>To build your application follow the steps mentioned in <a class="el" href="GETTING_STARTED_BUILD.html">Build a Hello World example</a> to build the application you want. Note the path to the <code>*.appimage</code> file that is generated as part of the build.</li>
</ul>
</li>
<li>Make sure you have installed python as mention in <a class="el" href="SDK_DOWNLOAD_PAGE.html#INSTALL_PYTHON3">Python3</a></li>
<li>Make sure you have identified the UART port on the EVM as mentioned in <a class="el" href="EVM_SETUP_PAGE.html">EVM Setup</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md774"></a>
Flash configuration file</h2>
<ul>
<li>Create a flash configuration file, using the default flash configuration file present at below as reference <pre class="fragment">  ${SDK_INSTALL_PATH}/tools/boot/sbl_prebuilt/am64x-evm/default_sbl_ospi.cfg
</pre></li>
<li>In this config file, modify the paths to the flashing application and OSPI bootloader, in case you are not using the pre-built applications <pre class="fragment">  --flash-writer={path to flash application .tiimage}
  --file={path to OSPI bootloader .tiimage} --operation=flash --flash-offset=0x0
</pre></li>
<li>Edit below line to point to the user application (<code>.appimage</code>) file <pre class="fragment">  --file={path to your application .appimage file} --operation=flash --flash-offset=0x80000
</pre></li>
<li>Edit below line to point to the user application XIP image (<code>.appimage_xip</code>) file. When not using XIP mode, this file input is optional. <pre class="fragment">  --file={path to your application .appimage_xip file} --operation=flash-xip
</pre></li>
</ul>
<h2><a class="anchor" id="autotoc_md775"></a>
Flash configuration file for flashing to eMMC</h2>
<ul>
<li>Create a flash configuration file, check the flash configuration file preset at below as reference <pre class="fragment">  ${SDK_INSTALL_PATH}/examples/drivers/boot/sbl_emmc_linux/am64x-evm/r5fss0-0_nortos/default_sbl_emmc_linux.cfg
</pre></li>
<li>The flashing application and the eMMC bootloader needs to be specified in this file as <pre class="fragment">  --flash-writer={path to flash application .tiimage}
  --file={path to eMMC bootloader .tiimage} --operation=flash-emmc --flash-offset=0x0
</pre></li>
<li>The user application (<code>.appimage</code>) file needs to be specified in the configuration file as <pre class="fragment">  --file={path to your application .appimage file} --operation=flash-emmc --flash-offset=0x800000
</pre></li>
</ul>
<h2><a class="anchor" id="autotoc_md776"></a>
Flashing the files</h2>
<ul>
<li>Set EVM in <a class="el" href="EVM_SETUP_PAGE.html#BOOTMODE_UART">UART BOOT MODE</a> and power on the EVM</li>
<li>Run below python command on the Windows command prompt (<code>cmd.exe</code>) or Linux bash shell to flash the files. <pre class="fragment">  cd ${SDK_INSTALL_PATH}/tools/boot
  python uart_uniflash.py -p {name of your UART com port} --cfg={path to your edited config file}
</pre></li>
<li>At each step in the flashing your will see success or error messages, including progress as the file is being transferred.</li>
<li>If flashing is successful, power OFF the EVM, set the EVM to <a class="el" href="EVM_SETUP_PAGE.html#BOOTMODE_OSPI">OSPI BOOT MODE</a> and power ON the EVM to run the flashed application.</li>
<li>If flashing is not successful, then check the error messages and take appropriate action (See <a class="el" href="TOOLS_FLASH.html#TOOLS_FLASH_ERROR_MESSAGES">Flash tool error messages and solutions</a>).</li>
</ul>
<h2><a class="anchor" id="autotoc_md777"></a>
Flash tool options</h2>
<ul>
<li>Type below to see all the possible options with the flashing tool and also see the default .cfg file for syntax and options possible in the config file <pre class="fragment">  cd ${SDK_INSTALL_PATH}/tools/boot
  python uart_uniflash.py --help
</pre></li>
</ul>
<h1><a class="anchor" id="TOOLS_FLASH_ERROR_MESSAGES"></a>
Flash tool error messages and solutions</h1>
<p>If the flashing fails, the error message will give a hint as to why it failed. Some common error messages, reasons and potential solutions are listed below.</p>
<table class="doxtable">
<tr>
<th>Error </th><th>Possible Reason </th><th>Solution  </th></tr>
<tr>
<td>Serial port not found or not accessible </td><td>Wrong UART port passed as argument or the UART port is open in some other terminal application. </td><td>Check the UART port, UART ports are named as <code>COM1</code>, <code>COM2</code>, and so on in Windows and as <code>/dev/ttyUSB0</code>, <code>/dev/ttyUSB1</code>, and so on in Linux. Also make sure to close all open UART terminals and try again.  </td></tr>
<tr>
<td>No response or error response from EVM. </td><td>Either EVM is not in power-ON state or EVM is not setup in UART boot mode. </td><td>Use Ctrl-C to terminate the script if it is stuck. Check UART boot mode switch setting, check power to EVM, power-cycle EVM and try again  </td></tr>
<tr>
<td>Flashing failed error message </td><td>This should not happen ideally on TI EVMs. On custom EVM this could happen if there is some issue in the flash driver on the EVM. </td><td>Power cycle EVM and try again. If the problem still does not go away, then likely the flash on the EVM has gone bad. Try other SOC initialization options and check the flash driver via CCS IDE debug.  </td></tr>
<tr>
<td>Config file parsing error </td><td>Wrong config file passed or input files not found. </td><td>Check the message that is printed, and edit the config file to fix the parsing errors. Make sure to specify file paths with forward slash <code>/</code>, including in Windows. The default config file should not have any errors though.  </td></tr>
<tr>
<td>Python not found error or python packages not not found error </td><td>Python or python packages needed for this script are not installed </td><td>Follow steps mentioned in <a class="el" href="SDK_DOWNLOAD_PAGE.html#INSTALL_PYTHON3">Python3</a> to install python and related packages  </td></tr>
<tr>
<td>Parsing config file error </td><td>SBL binaries are missing from the prebuilt folder </td><td>Build sbl using below command:<div class="fragment"><div class="line">gmake -s sbl DEVICE=am243x </div>
</div><!-- fragment -->  </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md778"></a>
Detailed sequence of steps that happen when flashing files</h1>
<dl class="section note"><dt>Note</dt><dd>This section has more detailed sequence of steps that happen underneath the tools and on the EVM for reference.</dd></dl>
<p>The detailed sequence of steps that happen when flashing files is listed below, refer to the <a class="el" href="EVM_SETUP_PAGE.html">EVM Setup</a> page to see how to setup the EVM in different boot modes that are needed for this sequence of steps.</p>
<ul>
<li>Set EVM in UART boot mode and power it on, the SOC ROM bootloader waits to receive a file using the UART+XMODEM protocol.</li>
<li>PC sends the flashing application file (<code>sbl_uart_uniflash.release.tiimage</code>) via the flashing tool using UART+XMODEM protocol underneath.</li>
<li>The ROM bootloader, boots the flashing application</li>
<li>The flashing application now initializes the flash on the EVM and waits for additional commands using UART+XMODEM protocol</li>
<li>The PC tool can now send one or more of below commands with the file data, one after the other, until it is done.<ul>
<li>Flash a file at a given offset in the flash</li>
<li>Verify a previously flashed file at a given offset in the flash</li>
<li>Erase a region of flash memory</li>
</ul>
</li>
<li>The flashing application as such does not care what the file contains, it will simply flash it at the user specified location.</li>
<li>However typically one needs to at least send the below files to flash<ul>
<li>Send a OSPI flash bootloader application and flash it at offset 0x0 (<code>sbl_ospi.release.tiimage</code>). If the OSPI bootloader is already flashed previously then this step can be skipped.</li>
<li>Send your application image multi-core image and flash it at offset 0x80000 (<code>*.appimage</code>). The offset 0x80000 is the offset that is specified in the OSPI bootloader and when the EVM boots in OSPI mode, it will attempt to find a application at this location.</li>
</ul>
</li>
<li>After flashing is done, power OFF the EVM</li>
<li>Set EVM in OSPI boot mode and power ON the EVM.<ul>
<li>The ROM bootloader will now boot the OSPI bootloader by reading offset 0x0</li>
<li>And the OSPI bootloader will boot the application by reading from offset 0x80000.</li>
</ul>
</li>
<li>The initial flashing application and the subsequent commands to send and flash the OSPI bootloader and application files are all specified in a single configuration file which is provided as input to the tool. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
