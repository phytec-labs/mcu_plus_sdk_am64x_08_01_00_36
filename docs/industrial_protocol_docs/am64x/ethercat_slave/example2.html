<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<title>EtherCAT Slave: CiA 402 Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EtherCAT Slave
   &#160;<span id="projectnumber">1.04.06</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('example2.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">CiA 402 Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="section4221"></a>
Scope</h1>
<p>This example covers how to load an ESI File to the DTK and how to enable the CiA 402 device profile.</p>
<h1><a class="anchor" id="section4222"></a>
Related Files</h1>
<p><a href="ec_slv_ci_a402_8c-example.html" class="ec_slv_ci_a402_8c-example.html">ecSlvCiA402.c</a><br  />
 <a href="ec_slv_ci_a402_8h-example.html" class="ec_slv_ci_a402_8h-example.html">ecSlvCiA402.h</a><br  />
 <a href="_e_s_l_cia402_demo_8c-example.html" class="_e_s_l_cia402_demo_8c-example.html">ESL_cia402Demo.c</a><br  />
 <a href="_e_s_l_cia402_demo_8h-example.html" class="_e_s_l_cia402_demo_8h-example.html">ESL_cia402Demo.h</a><br  />
 <a href="_e_s_l_cia402_obd_8c-example.html" class="_e_s_l_cia402_obd_8c-example.html">ESL_cia402Obd.c</a><br  />
 <a href="_e_s_l_cia402_obd_8h-example.html" class="_e_s_l_cia402_obd_8h-example.html">ESL_cia402Obd.h</a><br  />
 <a href="_ether_c_a_t__slave__ci_a402_8c-example.html" class="_ether_c_a_t__slave__ci_a402_8c-example.html">EtherCAT_Slave_CiA402.c</a><br  />
</p>
<h1><a class="anchor" id="section4226"></a>
CiA 402 Example</h1>
<p>This example configures a 3 axes motor control application. If the device or the ESI file (EtherCAT Slave Information) does not support the CiA 402 device profile, the subsequent registration calls should be disabled. The following functions are implemented in <a href="_e_s_l_cia402_demo_8c-example.html" class="_e_s_l_cia402_demo_8c-example.html">ESL_cia402Demo.c</a>.</p>
<h2><a class="anchor" id="subsection42261"></a>
EC_SLV_APP_motionControl</h2>
<p>Motion control is done in this function. The control of modes CSP, CSV or CST is shown.</p>
<h2><a class="anchor" id="subsection42262"></a>
EC_SLV_APP_cia402Application</h2>
<p>The function contains an implementation of the CiA 402 State Machine (although an external one can be registered). This state machine works alongside the CiA 402 application. The application reads the control object (<code>0x6040</code>) and writes the status object (<code>0x6041</code>). The application activates the axis and checks if there is any error pending. If an error is pending then it calls to transition actions to resolve the error and clears the error status if required.</p>
<h2><a class="anchor" id="subsection42263"></a>
EC_SLV_APP_cia402LocalError</h2>
<p>If the CiA 402 State machine changes to an error state this function is called. It is used to notify the error, not to take any action.</p>
<h1><a class="anchor" id="section4223"></a>
Basic Setup</h1>
<p>The example starts by initializing operating system (OSAL) and hardware abstraction layers (HWAL). The EtherCAT functionality itself is implemented within the <code>kbAppl_LoopTask</code> that is started from the <code>main</code> application entry point, both are implemented in <code></code> <a href="_ether_c_a_t__slave__e_s_i__parser_8c-example.html" class="_ether_c_a_t__slave__e_s_i__parser_8c-example.html">EtherCAT_Slave_ESI_Parser.c</a>.</p>
<h1><a class="anchor" id="section4224"></a>
Hardware Setup</h1>
<p><code>kbAppl_LoopTask</code> starts with the initialization of the GPIO driver and the configuration of the PHY and LED pins in the function <code>EC_SLAVE_APP_initBoardFunctions</code> in <code></code> <a href="ec_slv_e_s_i_8c-example.html" class="ec_slv_e_s_i_8c-example.html">ecSlvESI.c</a>.</p>
<p>Next PHY parameters, such as address, polarity and RX link are configured in <code>EC_SLAVE_APP_registerStacklessBoardFunctions</code>. The KUNBUS EtherCAT DTK supports Texas Instruments <code>TLK105</code>, <code>TLK110</code> and Microchip <code>KSZ8041NL</code> PHYs by default. Alternative PHYs may be used. In this case the DTK user has to implement and register the functions to handle the new PHYs. Use the <code>ESL_phyLibTlk110</code> sources as reference to implement your own PHY driver.</p>
<table class="image">
<caption>Program flow of the EtherCAT Slave ESI Parser Example Application</caption>
<tr>
<td><div class="image">
<img src="KBEtherCAT_ESI.png" alt=""/>
</div>
  </td></tr>
</table>
<h1><a class="anchor" id="section4225"></a>
Initialization of Stack, PRU, and Device Identification</h1>
<p>Before entering the main stack loop, the example application itself is initialized in <code>EC_SLAVE_APP_applicationInit</code>. This function creates a new EtherCAT Slave device instance, registers a board status LED callback, sets vendor ID, product code and name, revision number, etc.</p>
<table class="image">
<caption>Program flow of the EtherCAT Slave ESI Parser Example Application</caption>
<tr>
<td><div class="image">
<img src="EC_SLV_ESI_applicationInit.png" alt=""/>
</div>
  </td></tr>
</table>
<p>After the basic initialization, <code>EC_SLAVE_APP_applicationInit</code> contiues with the setup of the CiA 402 example drives and motion control example.</p>
<h1><a class="anchor" id="section4226"></a>
CiA 402 Example</h1>
<p>This example configures a 3 axes motor control application. If the device or the ESI file (EtherCAT Slave Information) does not support the CiA 402 device profile, the subsequent registration calls should be disabled. The following functions are implemented in <a href="_e_s_l_cia402_demo_8c-example.html" class="_e_s_l_cia402_demo_8c-example.html">ESL_cia402Demo.c</a>.</p>
<h2><a class="anchor" id="subsection42261"></a>
EC_SLV_APP_motionControl</h2>
<p>If the ESI parser is used (see below), then the Object Dictionary is generated and configured based on the information contained in the EtherCAT Slave Information file. However, if the parser is not used or the ESI file does not contain information, use this function to set the data of the CiA 402 objects.</p>
<h2><a class="anchor" id="subsection42262"></a>
EC_SLV_APP_cia402Application</h2>
<p>Application example from the Beckhoff EtherCAT Slave Code. The function contains an implementation of the CiA 402 State Machine (although an external one can be registered). This state machine works alongside the CiA 402 application. The application reads the control object (<code>0x6040</code>) and writes the status object (<code>0x6041</code>). The application activates the axis and checks if there is any error pending. If an error is pending then it calls to transition actions to resolve the error and clears the error status if required.</p>
<h2><a class="anchor" id="subsection42263"></a>
EC_SLV_APP_cia402LocalError</h2>
<p>If the CiA 402 State machine changes to an error state this function is called. It is used to notify the error, not to take any action.</p>
<h2><a class="anchor" id="subsection42264"></a>
EC_SLAVE_APP_usrStartInputHandler</h2>
<p>Register a callback function that may be used to prevent the transition from PREOP to SAFEOP in the EtherCAT State Machine (ESM).</p>
<p>Here used to read the Distributed Clock registers to retrieve the Sync0 synchronization cycle time.</p>
<h2><a class="anchor" id="subsection42265"></a>
EC_API_SLV_parseEsiFile</h2>
<p>EtherCAT Slave Information files (ESI) describe EtherCAT specific as well as application specific features of the slave. Every slave shall be devlivered with an EtherCAT Slave Information file. The <code>EC_API_SLV_parseEsiFile()</code> function parses the slave ESI file and generates automatically the EtherCAT configuration. Therefore, as the slave configuration is read from the ESI file, it is no longer required to use the device identification and basic configuration functions, Object Dictionary functions, or the Process Data mapping functions for example.</p>
<h2><a class="anchor" id="subsection42266"></a>
EC_SLAVE_APP_SetSupportedDriveModes</h2>
<p>Defines which supported drive modes are available. See ETG6010 Chapter 6.8.1 for more information.</p>
<h2><a class="anchor" id="subsection42267"></a>
CiA402_TransitionAction</h2>
<p>Called by the CiA402 Application. This function shall calculate the desired axis input values to move on a predefined ramp.</p>
<h2><a class="anchor" id="subsection42268"></a>
CiA402_DummyMotionControl</h2>
<p>Simulates a drive. It updates the CiA402 Object Dictionary data.</p>
<h1><a class="anchor" id="section4227"></a>
Initialization and starting the Stacks</h1>
<p>The <code><a class="el" href="group___e_c___a_p_i___s_l_v___b_a_s_i_c_ga5835de86b796042d04c50bc60f48cc60.html#ga5835de86b796042d04c50bc60f48cc60" title="This is the function to initialize the EtherCAT Slave API.">EC_API_SLV_init()</a></code> function initializes the DTK Stack and validates whether the user defined configuration is valid or not. If the EtherCAT configuration is valid, then object content can be written and finally, the <code><a class="el" href="group___e_c___a_p_i___s_l_v___b_a_s_i_c_gae8fd647dd229ca8feb5dcc0e65ba2104.html#gae8fd647dd229ca8feb5dcc0e65ba2104" title="This is the function to run the EtherCAT Slave API.">EC_API_SLV_run()</a></code> function starts the Beckhoff Stack. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
